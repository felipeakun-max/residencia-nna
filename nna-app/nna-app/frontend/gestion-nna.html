<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>GestiÃ³n Residencia NNA</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet"/>
<style>
:root {
  --navy: #0f1f3d;
  --navy-mid: #1a3060;
  --navy-light: #2a4a8a;
  --slate: #3d5a80;
  --steel: #607d9c;
  --fog: #e8eef5;
  --mist: #f4f7fb;
  --white: #ffffff;
  --accent: #2a7fff;
  --accent-light: #5b9fff;
  --success: #2e9e6b;
  --warning: #e8a020;
  --danger: #d94040;
  --text-main: #0f1f3d;
  --text-mid: #4a5f7a;
  --text-soft: #8a9db5;
  --border: #d0daea;
  --shadow-sm: 0 1px 4px rgba(15,31,61,0.08);
  --shadow-md: 0 4px 16px rgba(15,31,61,0.12);
  --shadow-lg: 0 8px 32px rgba(15,31,61,0.16);
  --radius: 12px;
  --radius-sm: 8px;
  --sidebar-w: 260px;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--mist);
  color: var(--text-main);
  min-height: 100vh;
  display: flex;
}

/* â”€â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sidebar {
  width: var(--sidebar-w);
  background: var(--navy);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  position: fixed;
  top: 0; left: 0;
  z-index: 100;
  transition: transform 0.3s ease;
}

.sidebar-header {
  padding: 28px 24px 20px;
  border-bottom: 1px solid rgba(255,255,255,0.08);
}

.logo {
  display: flex;
  align-items: center;
  gap: 12px;
}

.logo-icon {
  width: 40px; height: 40px;
  background: var(--accent);
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 18px;
  flex-shrink: 0;
}

.logo-text h1 {
  font-family: 'DM Serif Display', serif;
  font-size: 15px;
  color: var(--white);
  line-height: 1.2;
}

.logo-text span {
  font-size: 11px;
  color: var(--steel);
  font-weight: 400;
  letter-spacing: 0.3px;
}

.nav-section {
  padding: 16px 12px 8px;
}

.nav-label {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 1.2px;
  color: var(--steel);
  font-weight: 600;
  padding: 0 12px 8px;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 12px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.2s;
  color: rgba(255,255,255,0.65);
  font-size: 14px;
  font-weight: 400;
  margin-bottom: 2px;
  text-decoration: none;
}

.nav-item:hover {
  background: rgba(255,255,255,0.08);
  color: var(--white);
}

.nav-item.active {
  background: var(--accent);
  color: var(--white);
  font-weight: 500;
}

.nav-item .nav-icon {
  width: 20px;
  text-align: center;
  font-size: 16px;
  flex-shrink: 0;
}

.nav-badge {
  margin-left: auto;
  background: var(--danger);
  color: white;
  font-size: 10px;
  font-weight: 700;
  padding: 2px 6px;
  border-radius: 20px;
  min-width: 18px;
  text-align: center;
}

.sidebar-footer {
  margin-top: auto;
  padding: 16px 12px;
  border-top: 1px solid rgba(255,255,255,0.08);
}

.user-card {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: background 0.2s;
}
.user-card:hover { background: rgba(255,255,255,0.08); }

.user-avatar {
  width: 34px; height: 34px;
  background: var(--navy-light);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 13px;
  font-weight: 600;
  color: var(--white);
  flex-shrink: 0;
}

.user-info { flex: 1; min-width: 0; }
.user-name {
  font-size: 13px;
  color: var(--white);
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.user-role {
  font-size: 11px;
  color: var(--steel);
}

/* â”€â”€â”€ MAIN CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.main {
  margin-left: var(--sidebar-w);
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

.topbar {
  background: var(--white);
  border-bottom: 1px solid var(--border);
  padding: 0 32px;
  height: 64px;
  display: flex;
  align-items: center;
  gap: 16px;
  position: sticky;
  top: 0;
  z-index: 50;
}

.topbar-title {
  font-size: 17px;
  font-weight: 600;
  color: var(--text-main);
}

.topbar-subtitle {
  font-size: 13px;
  color: var(--text-soft);
  margin-left: 4px;
}

.topbar-actions {
  margin-left: auto;
  display: flex;
  align-items: center;
  gap: 10px;
}

.search-box {
  display: flex;
  align-items: center;
  gap: 8px;
  background: var(--mist);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 7px 14px;
  width: 220px;
  transition: border-color 0.2s;
}
.search-box:focus-within { border-color: var(--accent); }
.search-box input {
  border: none;
  background: transparent;
  font-size: 13px;
  color: var(--text-main);
  outline: none;
  width: 100%;
  font-family: 'DM Sans', sans-serif;
}
.search-box input::placeholder { color: var(--text-soft); }

.btn-icon {
  width: 36px; height: 36px;
  border: 1px solid var(--border);
  background: var(--white);
  border-radius: var(--radius-sm);
  display: flex; align-items: center; justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
  font-size: 15px;
  color: var(--text-mid);
  position: relative;
}
.btn-icon:hover { background: var(--mist); border-color: var(--accent); color: var(--accent); }

.notif-dot {
  position: absolute;
  top: 6px; right: 6px;
  width: 7px; height: 7px;
  background: var(--danger);
  border-radius: 50%;
  border: 1.5px solid white;
}

.btn {
  display: inline-flex;
  align-items: center;
  gap: 7px;
  padding: 8px 16px;
  border-radius: var(--radius-sm);
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  border: none;
  transition: all 0.2s;
  font-family: 'DM Sans', sans-serif;
  text-decoration: none;
}

.btn-primary {
  background: var(--accent);
  color: white;
}
.btn-primary:hover { background: var(--navy-light); }

.btn-outline {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--text-mid);
}
.btn-outline:hover { border-color: var(--accent); color: var(--accent); background: rgba(42,127,255,0.05); }

.btn-danger {
  background: var(--danger);
  color: white;
}

.btn-success {
  background: var(--success);
  color: white;
}

/* â”€â”€â”€ PAGE CONTENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.page-content {
  padding: 28px 32px;
  flex: 1;
}

.page { display: none; animation: fadeIn 0.3s ease; }
.page.active { display: block; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

/* â”€â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
  margin-bottom: 24px;
}

.stat-card {
  background: var(--white);
  border-radius: var(--radius);
  padding: 20px 22px;
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--border);
  position: relative;
  overflow: hidden;
  transition: box-shadow 0.2s;
}
.stat-card:hover { box-shadow: var(--shadow-md); }

.stat-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0;
  width: 4px; height: 100%;
  background: var(--accent);
}
.stat-card.success::before { background: var(--success); }
.stat-card.warning::before { background: var(--warning); }
.stat-card.danger::before { background: var(--danger); }

.stat-label {
  font-size: 12px;
  color: var(--text-soft);
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 8px;
}

.stat-value {
  font-size: 32px;
  font-weight: 700;
  color: var(--text-main);
  line-height: 1;
  margin-bottom: 6px;
  font-family: 'DM Serif Display', serif;
}

.stat-change {
  font-size: 12px;
  color: var(--text-soft);
}
.stat-change.up { color: var(--success); }
.stat-change.down { color: var(--danger); }

.stat-icon {
  position: absolute;
  top: 18px; right: 18px;
  font-size: 24px;
  opacity: 0.15;
}

/* Grid 2 col */
.grid-2 {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
  margin-bottom: 24px;
}

.grid-3 {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 16px;
}

.card {
  background: var(--white);
  border-radius: var(--radius);
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--border);
  overflow: hidden;
}

.card-header {
  padding: 18px 22px 14px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.card-title {
  font-size: 14px;
  font-weight: 600;
  color: var(--text-main);
}

.card-body {
  padding: 20px 22px;
}

/* Alertas en dashboard */
.alert-list { display: flex; flex-direction: column; gap: 10px; }

.alert-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 14px;
  border-radius: var(--radius-sm);
  background: var(--mist);
  border-left: 3px solid var(--warning);
  font-size: 13px;
  cursor: pointer;
  transition: background 0.2s;
}
.alert-item:hover { background: var(--fog); }
.alert-item.high { border-left-color: var(--danger); }
.alert-item.low { border-left-color: var(--success); }

.alert-dot {
  width: 8px; height: 8px;
  border-radius: 50%;
  background: var(--warning);
  flex-shrink: 0;
}
.alert-dot.high { background: var(--danger); }
.alert-dot.low { background: var(--success); }

.alert-text { flex: 1; }
.alert-name { font-weight: 500; color: var(--text-main); }
.alert-reason { font-size: 11px; color: var(--text-soft); margin-top: 1px; }

.alert-time { font-size: 11px; color: var(--text-soft); }

/* Recientes */
.nna-list { display: flex; flex-direction: column; }

.nna-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 13px 0;
  border-bottom: 1px solid var(--fog);
  cursor: pointer;
  transition: background 0.15s;
}
.nna-item:last-child { border-bottom: none; }
.nna-item:hover { background: var(--mist); margin: 0 -22px; padding: 13px 22px; }

.nna-avatar {
  width: 36px; height: 36px;
  border-radius: 10px;
  background: var(--fog);
  display: flex; align-items: center; justify-content: center;
  font-weight: 700;
  font-size: 13px;
  color: var(--slate);
  flex-shrink: 0;
}

.nna-info { flex: 1; min-width: 0; }
.nna-name { font-size: 13px; font-weight: 500; color: var(--text-main); }
.nna-meta { font-size: 11px; color: var(--text-soft); margin-top: 1px; }

.badge {
  display: inline-flex;
  align-items: center;
  padding: 3px 9px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 0.2px;
}
.badge-active { background: rgba(46,158,107,0.12); color: var(--success); }
.badge-egreso { background: rgba(96,125,156,0.12); color: var(--steel); }
.badge-suspension { background: rgba(232,160,32,0.12); color: var(--warning); }
.badge-alto { background: rgba(217,64,64,0.12); color: var(--danger); }
.badge-medio { background: rgba(232,160,32,0.12); color: var(--warning); }
.badge-bajo { background: rgba(46,158,107,0.12); color: var(--success); }
.badge-blue { background: rgba(42,127,255,0.12); color: var(--accent); }

/* â”€â”€â”€ BAR CHART MANUAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.bar-chart { display: flex; align-items: flex-end; gap: 8px; height: 120px; padding: 0 4px; }
.bar-wrap { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; height: 100%; justify-content: flex-end; }
.bar {
  width: 100%;
  background: var(--accent);
  border-radius: 4px 4px 0 0;
  min-height: 4px;
  opacity: 0.85;
  transition: opacity 0.2s;
  position: relative;
}
.bar:hover { opacity: 1; }
.bar-label { font-size: 10px; color: var(--text-soft); }
.bar-val { font-size: 10px; color: var(--text-mid); font-weight: 600; }

/* â”€â”€â”€ TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.table-wrap { overflow-x: auto; }

table {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
}

thead tr {
  background: var(--mist);
  border-bottom: 2px solid var(--border);
}

th {
  padding: 11px 14px;
  text-align: left;
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.6px;
  color: var(--text-soft);
  font-weight: 600;
  white-space: nowrap;
}

td {
  padding: 13px 14px;
  border-bottom: 1px solid var(--fog);
  color: var(--text-main);
  vertical-align: middle;
}

tr:last-child td { border-bottom: none; }
tr:hover td { background: var(--mist); }

.td-name { font-weight: 500; }
.td-sub { font-size: 11px; color: var(--text-soft); margin-top: 2px; }

.action-btns { display: flex; gap: 6px; }
.btn-sm {
  padding: 5px 10px;
  font-size: 12px;
  border-radius: 6px;
}

/* â”€â”€â”€ FORM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.form-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.form-group.full { grid-column: span 2; }

label {
  font-size: 12px;
  font-weight: 600;
  color: var(--text-mid);
  text-transform: uppercase;
  letter-spacing: 0.4px;
}

input, select, textarea {
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 9px 12px;
  font-size: 13px;
  font-family: 'DM Sans', sans-serif;
  color: var(--text-main);
  background: var(--white);
  outline: none;
  transition: border-color 0.2s;
  width: 100%;
}

input:focus, select:focus, textarea:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(42,127,255,0.1);
}

textarea { resize: vertical; min-height: 90px; }

.form-actions {
  display: flex;
  gap: 10px;
  padding-top: 8px;
  margin-top: 4px;
  border-top: 1px solid var(--border);
  justify-content: flex-end;
}

/* â”€â”€â”€ MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(15,31,61,0.5);
  backdrop-filter: blur(4px);
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s;
}

.modal-overlay.open {
  opacity: 1;
  pointer-events: all;
}

.modal {
  background: var(--white);
  border-radius: 16px;
  box-shadow: var(--shadow-lg);
  width: 100%;
  max-width: 620px;
  max-height: 90vh;
  overflow-y: auto;
  transform: translateY(20px) scale(0.98);
  transition: transform 0.25s;
}

.modal-overlay.open .modal {
  transform: translateY(0) scale(1);
}

.modal-header {
  padding: 22px 26px 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.modal-title {
  font-size: 16px;
  font-weight: 600;
  color: var(--text-main);
}

.modal-close {
  width: 30px; height: 30px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: transparent;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  font-size: 14px;
  color: var(--text-soft);
  transition: all 0.2s;
}
.modal-close:hover { background: var(--mist); color: var(--text-main); }

.modal-body { padding: 22px 26px; }
.modal-footer {
  padding: 16px 26px;
  border-top: 1px solid var(--border);
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

/* â”€â”€â”€ LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
#login-screen {
  position: fixed;
  inset: 0;
  background: var(--navy);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  transition: opacity 0.4s;
}

#login-screen.hidden {
  opacity: 0;
  pointer-events: none;
}

.login-bg {
  position: absolute;
  inset: 0;
  overflow: hidden;
}

.login-bg-circle {
  position: absolute;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(42,127,255,0.15), transparent 70%);
}

.login-bg-circle:nth-child(1) { width: 600px; height: 600px; top: -200px; right: -100px; }
.login-bg-circle:nth-child(2) { width: 400px; height: 400px; bottom: -100px; left: -100px; }

.login-card {
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 20px;
  padding: 44px 48px;
  width: 100%;
  max-width: 420px;
  backdrop-filter: blur(10px);
  position: relative;
  z-index: 1;
}

.login-logo {
  display: flex;
  align-items: center;
  gap: 14px;
  margin-bottom: 32px;
}

.login-logo-icon {
  width: 48px; height: 48px;
  background: var(--accent);
  border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  font-size: 22px;
}

.login-logo-text h2 {
  font-family: 'DM Serif Display', serif;
  font-size: 18px;
  color: var(--white);
  line-height: 1.2;
}
.login-logo-text span {
  font-size: 12px;
  color: var(--steel);
}

.login-form h3 {
  font-size: 22px;
  color: var(--white);
  margin-bottom: 6px;
}
.login-form p {
  font-size: 13px;
  color: var(--steel);
  margin-bottom: 28px;
}

.login-field { margin-bottom: 16px; }
.login-field label {
  display: block;
  font-size: 12px;
  color: rgba(255,255,255,0.6);
  margin-bottom: 6px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.login-field input {
  background: rgba(255,255,255,0.07);
  border: 1px solid rgba(255,255,255,0.12);
  color: var(--white);
  padding: 11px 14px;
}
.login-field input::placeholder { color: rgba(255,255,255,0.3); }
.login-field input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(42,127,255,0.2); }

.login-btn {
  width: 100%;
  padding: 12px;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: var(--radius-sm);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  margin-top: 8px;
  transition: background 0.2s;
  font-family: 'DM Sans', sans-serif;
}
.login-btn:hover { background: var(--navy-light); }

.login-hint {
  margin-top: 20px;
  text-align: center;
  font-size: 12px;
  color: var(--steel);
}

.demo-users {
  margin-top: 20px;
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 8px;
}

.demo-btn {
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 8px;
  padding: 8px;
  cursor: pointer;
  transition: background 0.2s;
  text-align: center;
}
.demo-btn:hover { background: rgba(255,255,255,0.1); }
.demo-btn span { display: block; font-size: 11px; color: rgba(255,255,255,0.5); }
.demo-btn strong { display: block; font-size: 12px; color: rgba(255,255,255,0.85); margin-top: 2px; }

/* â”€â”€â”€ SECTION HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
}

.section-title {
  font-size: 20px;
  font-weight: 700;
  color: var(--text-main);
}

.section-sub {
  font-size: 13px;
  color: var(--text-soft);
  margin-top: 2px;
}

/* â”€â”€â”€ FICHA NNA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.ficha-header {
  background: var(--white);
  border-radius: var(--radius);
  padding: 24px 28px;
  border: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
  display: flex;
  align-items: center;
  gap: 20px;
  margin-bottom: 20px;
}

.ficha-avatar {
  width: 64px; height: 64px;
  background: var(--fog);
  border-radius: 16px;
  display: flex; align-items: center; justify-content: center;
  font-size: 24px;
  font-weight: 700;
  color: var(--slate);
  flex-shrink: 0;
}

.ficha-name {
  font-size: 20px;
  font-weight: 700;
  color: var(--text-main);
  margin-bottom: 4px;
}

.ficha-meta {
  display: flex;
  gap: 16px;
  flex-wrap: wrap;
}

.ficha-meta-item {
  font-size: 12px;
  color: var(--text-soft);
  display: flex;
  align-items: center;
  gap: 4px;
}

.ficha-actions { margin-left: auto; display: flex; gap: 8px; }

.tabs {
  display: flex;
  gap: 2px;
  background: var(--fog);
  border-radius: var(--radius-sm);
  padding: 4px;
  margin-bottom: 20px;
  width: fit-content;
}

.tab {
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 13px;
  font-weight: 500;
  cursor: pointer;
  color: var(--text-soft);
  transition: all 0.2s;
  white-space: nowrap;
}

.tab.active {
  background: var(--white);
  color: var(--text-main);
  box-shadow: var(--shadow-sm);
}

.tab-content { display: none; }
.tab-content.active { display: block; animation: fadeIn 0.2s ease; }

/* â”€â”€â”€ PLAN TRABAJO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.plan-section {
  background: var(--white);
  border-radius: var(--radius);
  border: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
  margin-bottom: 16px;
}

.plan-section-header {
  padding: 16px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  border-bottom: 1px solid var(--border);
}

.plan-section-title {
  display: flex;
  align-items: center;
  gap: 10px;
  font-weight: 600;
  font-size: 14px;
  color: var(--text-main);
}

.plan-icon {
  width: 32px; height: 32px;
  border-radius: 8px;
  display: flex; align-items: center; justify-content: center;
  font-size: 15px;
}

.progress-row {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 20px;
  border-bottom: 1px solid var(--fog);
}

.progress-label { font-size: 13px; color: var(--text-mid); width: 140px; flex-shrink: 0; }

.progress-bar-wrap {
  flex: 1;
  height: 8px;
  background: var(--fog);
  border-radius: 4px;
  overflow: hidden;
}

.progress-bar-fill {
  height: 100%;
  border-radius: 4px;
  background: var(--accent);
  transition: width 0.5s ease;
}
.progress-bar-fill.success { background: var(--success); }
.progress-bar-fill.warning { background: var(--warning); }
.progress-bar-fill.danger { background: var(--danger); }

.progress-pct { font-size: 13px; font-weight: 600; color: var(--text-main); width: 36px; text-align: right; }

.objetivo-item {
  padding: 14px 20px;
  border-bottom: 1px solid var(--fog);
  display: flex;
  align-items: center;
  gap: 12px;
}
.objetivo-item:last-child { border-bottom: none; }

.objetivo-status {
  width: 10px; height: 10px;
  border-radius: 50%;
  flex-shrink: 0;
}
.status-progreso { background: var(--accent); }
.status-cumplido { background: var(--success); }
.status-pendiente { background: var(--text-soft); }

.objetivo-text { flex: 1; font-size: 13px; color: var(--text-main); }
.objetivo-dates { font-size: 11px; color: var(--text-soft); margin-top: 2px; }

/* â”€â”€â”€ INTERVENCION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.intervencion-card {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px 22px;
  margin-bottom: 14px;
  box-shadow: var(--shadow-sm);
  position: relative;
}

.intervencion-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0;
  width: 4px; height: 100%;
  background: var(--accent);
  border-radius: 4px 0 0 4px;
}
.intervencion-card.alto::before { background: var(--danger); }
.intervencion-card.medio::before { background: var(--warning); }
.intervencion-card.bajo::before { background: var(--success); }

.intervencion-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 12px;
}

.intervencion-tipo {
  font-weight: 600;
  font-size: 14px;
  color: var(--text-main);
  flex: 1;
}

.intervencion-fecha {
  font-size: 12px;
  color: var(--text-soft);
}

.intervencion-profesional {
  font-size: 12px;
  color: var(--text-soft);
  margin-bottom: 10px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.intervencion-desc {
  font-size: 13px;
  color: var(--text-mid);
  line-height: 1.6;
  margin-bottom: 12px;
}

.intervencion-tags {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

/* â”€â”€â”€ REGISTRO DIARIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.registro-card {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 18px 20px;
  margin-bottom: 12px;
  box-shadow: var(--shadow-sm);
}

.registro-date {
  font-size: 12px;
  color: var(--text-soft);
  margin-bottom: 6px;
  font-weight: 500;
}

.registro-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-top: 10px;
}

.registro-field-label {
  font-size: 11px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-soft);
  font-weight: 600;
  margin-bottom: 3px;
}

.registro-field-val {
  font-size: 13px;
  color: var(--text-mid);
}

.alerta-urgente {
  background: rgba(217,64,64,0.08);
  border: 1px solid rgba(217,64,64,0.2);
  border-radius: var(--radius-sm);
  padding: 10px 14px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: var(--danger);
  font-weight: 500;
  margin-top: 8px;
}

/* â”€â”€â”€ USUARIOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.user-table-avatar {
  width: 32px; height: 32px;
  border-radius: 8px;
  background: var(--fog);
  display: flex; align-items: center; justify-content: center;
  font-weight: 700;
  font-size: 12px;
  color: var(--slate);
}

.role-badge {
  display: inline-flex;
  align-items: center;
  padding: 3px 9px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 600;
}
.role-admin { background: rgba(15,31,61,0.1); color: var(--navy); }
.role-profesional { background: rgba(42,127,255,0.1); color: var(--accent); }
.role-monitor { background: rgba(96,125,156,0.1); color: var(--steel); }

/* â”€â”€â”€ EMPTY STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.empty-state {
  text-align: center;
  padding: 48px 20px;
  color: var(--text-soft);
}
.empty-icon { font-size: 40px; margin-bottom: 12px; opacity: 0.4; }
.empty-text { font-size: 14px; margin-bottom: 16px; }

/* â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media (max-width: 1100px) {
  .stats-grid { grid-template-columns: repeat(2, 1fr); }
  .grid-3 { grid-template-columns: 1fr; }
}

@media (max-width: 800px) {
  .sidebar { transform: translateX(-100%); }
  .sidebar.open { transform: translateX(0); }
  .main { margin-left: 0; }
  .stats-grid { grid-template-columns: 1fr 1fr; }
  .grid-2 { grid-template-columns: 1fr; }
  .form-grid { grid-template-columns: 1fr; }
  .form-group.full { grid-column: span 1; }
}

/* â”€â”€â”€ SCROLLBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--steel); }

/* â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toast-container {
  position: fixed;
  bottom: 24px; right: 24px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  z-index: 9998;
}

.toast {
  background: var(--navy);
  color: white;
  padding: 12px 18px;
  border-radius: var(--radius-sm);
  font-size: 13px;
  box-shadow: var(--shadow-lg);
  display: flex;
  align-items: center;
  gap: 10px;
  animation: slideUp 0.3s ease;
  max-width: 300px;
}
.toast.success { background: var(--success); }
.toast.error { background: var(--danger); }

@keyframes slideUp {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

/* â”€â”€â”€ DOCUMENTO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.doc-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 12px;
}

.doc-card {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 16px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s;
}
.doc-card:hover { border-color: var(--accent); box-shadow: var(--shadow-md); }

.doc-icon { font-size: 32px; margin-bottom: 8px; }
.doc-name { font-size: 12px; font-weight: 500; color: var(--text-main); }
.doc-date { font-size: 11px; color: var(--text-soft); margin-top: 3px; }

/* â”€â”€â”€ FILTROS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.filters-bar {
  display: flex;
  gap: 10px;
  margin-bottom: 16px;
  flex-wrap: wrap;
}

.filter-select {
  padding: 7px 12px;
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  font-size: 13px;
  background: var(--white);
  color: var(--text-mid);
  cursor: pointer;
}
</style>
</head>
<body>

<!-- â•â•â• LOGIN SCREEN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="login-screen">
  <div class="login-bg">
    <div class="login-bg-circle"></div>
    <div class="login-bg-circle"></div>
  </div>
  <div class="login-card">
    <div class="login-logo">
      <div class="login-logo-icon">ğŸ </div>
      <div class="login-logo-text">
        <h2>GestiÃ³n Residencia NNA</h2>
        <span>Sistema de gestiÃ³n institucional</span>
      </div>
    </div>
    <div class="login-form">
      <h3>Iniciar sesiÃ³n</h3>
      <p>Acceso restringido a personal autorizado</p>
      <div class="login-field">
        <label>Correo electrÃ³nico</label>
        <input type="email" id="login-email" placeholder="nombre@residencia.cl" value="admin@residencia.cl"/>
      </div>
      <div class="login-field">
        <label>ContraseÃ±a</label>
        <input type="password" id="login-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" value="admin123"/>
      </div>
      <button class="login-btn" onclick="doLogin()">Ingresar al sistema</button>
      <div class="login-hint">Â¿Problemas para acceder? Contacte al administrador</div>

      <div style="margin-top:20px; border-top:1px solid rgba(255,255,255,0.08); padding-top:16px;">
        <div style="font-size:11px; color:var(--steel); margin-bottom:8px; text-align:center; text-transform:uppercase; letter-spacing:0.5px;">Acceso demo rÃ¡pido</div>
        <div class="demo-users">
          <div class="demo-btn" onclick="quickLogin('admin@residencia.cl','admin123','Administrador')">
            <span>ğŸ‘¤</span><strong>Admin</strong>
          </div>
          <div class="demo-btn" onclick="quickLogin('ts@residencia.cl','prof123','Trabajador Social')">
            <span>ğŸ§‘â€ğŸ’¼</span><strong>Profesional</strong>
          </div>
          <div class="demo-btn" onclick="quickLogin('monitor@residencia.cl','mon123','Monitor')">
            <span>ğŸ‘ï¸</span><strong>Monitor</strong>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â• APP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<!-- SIDEBAR -->
<nav class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <div class="logo">
      <div class="logo-icon">ğŸ </div>
      <div class="logo-text">
        <h1>Residencia NNA</h1>
        <span>Sistema de gestiÃ³n</span>
      </div>
    </div>
  </div>

  <div class="nav-section">
    <div class="nav-label">Principal</div>
    <a class="nav-item active" onclick="showPage('dashboard')">
      <span class="nav-icon">ğŸ“Š</span> Dashboard
    </a>
    <a class="nav-item" onclick="showPage('nna')">
      <span class="nav-icon">ğŸ‘¤</span> Fichas NNA
    </a>
    <a class="nav-item" onclick="showPage('intervenciones')">
      <span class="nav-icon">ğŸ“</span> Intervenciones
    </a>
    <a class="nav-item" onclick="showPage('seguimiento')">
      <span class="nav-icon">ğŸ“…</span> Seguimiento Diario
    </a>
  </div>

  <div class="nav-section">
    <div class="nav-label">GestiÃ³n</div>
    <a class="nav-item" onclick="showPage('alertas')">
      <span class="nav-icon">ğŸ””</span> Alertas
      <span class="nav-badge">3</span>
    </a>
    <a class="nav-item" onclick="showPage('reportes')">
      <span class="nav-icon">ğŸ“„</span> Reportes
    </a>
    <a class="nav-item admin-only" onclick="showPage('usuarios')">
      <span class="nav-icon">ğŸ‘¥</span> Usuarios
    </a>
  </div>

  <div class="nav-section admin-only">
    <div class="nav-label">Admin</div>
    <a class="nav-item" onclick="showPage('config')">
      <span class="nav-icon">âš™ï¸</span> ConfiguraciÃ³n
    </a>
  </div>

  <div class="sidebar-footer">
    <div class="user-card" onclick="showToast('Cerrando sesiÃ³n...', 'success'); setTimeout(logout, 1200)">
      <div class="user-avatar" id="sidebar-avatar">AM</div>
      <div class="user-info">
        <div class="user-name" id="sidebar-name">Ana MartÃ­nez</div>
        <div class="user-role" id="sidebar-role">Administradora</div>
      </div>
      <span style="color:var(--steel); font-size:13px;">â†’</span>
    </div>
  </div>
</nav>

<!-- MAIN -->
<div class="main">
  <header class="topbar">
    <span class="topbar-title" id="page-title">Dashboard</span>
    <div class="topbar-actions">
      <div class="search-box">
        <span>ğŸ”</span>
        <input type="text" placeholder="Buscar por nombre o RUT..." oninput="handleSearch(this.value)"/>
      </div>
      <button class="btn-icon" onclick="toggleDarkMode()" title="Modo oscuro">ğŸŒ™</button>
      <button class="btn-icon" onclick="showPage('alertas')" title="Alertas">
        ğŸ””
        <span class="notif-dot"></span>
      </button>
    </div>
  </header>

  <div class="page-content">

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="page active" id="page-dashboard">
      <div class="section-header">
        <div>
          <div class="section-title">Resumen General</div>
          <div class="section-sub">Residencia Los Arrayanes Â· Febrero 2025</div>
        </div>
        <button class="btn btn-primary" onclick="showPage('nna')">+ Nuevo NNA</button>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <span class="stat-icon">ğŸ‘¥</span>
          <div class="stat-label">NNA Activos</div>
          <div class="stat-value">18</div>
          <div class="stat-change up">â†‘ 2 este mes</div>
        </div>
        <div class="stat-card warning">
          <span class="stat-icon">âš ï¸</span>
          <div class="stat-label">Casos con Alerta</div>
          <div class="stat-value">3</div>
          <div class="stat-change down">â†‘ 1 nueva</div>
        </div>
        <div class="stat-card success">
          <span class="stat-icon">ğŸ“</span>
          <div class="stat-label">Intervenciones / Mes</div>
          <div class="stat-value">24</div>
          <div class="stat-change up">â†‘ 8 vs mes anterior</div>
        </div>
        <div class="stat-card">
          <span class="stat-icon">âœ…</span>
          <div class="stat-label">Cumplimiento Plan</div>
          <div class="stat-value">71%</div>
          <div class="stat-change">+3% vs mes anterior</div>
        </div>
      </div>

      <div class="grid-3">
        <div class="card">
          <div class="card-header">
            <div class="card-title">Intervenciones por mes</div>
            <select class="filter-select" style="font-size:12px;padding:4px 8px;">
              <option>2025</option><option>2024</option>
            </select>
          </div>
          <div class="card-body">
            <div class="bar-chart">
              <div class="bar-wrap">
                <div class="bar-val">12</div>
                <div class="bar" style="height:40%"></div>
                <div class="bar-label">Sep</div>
              </div>
              <div class="bar-wrap">
                <div class="bar-val">18</div>
                <div class="bar" style="height:60%"></div>
                <div class="bar-label">Oct</div>
              </div>
              <div class="bar-wrap">
                <div class="bar-val">15</div>
                <div class="bar" style="height:50%"></div>
                <div class="bar-label">Nov</div>
              </div>
              <div class="bar-wrap">
                <div class="bar-val">21</div>
                <div class="bar" style="height:70%"></div>
                <div class="bar-label">Dic</div>
              </div>
              <div class="bar-wrap">
                <div class="bar-val">16</div>
                <div class="bar" style="height:53%"></div>
                <div class="bar-label">Ene</div>
              </div>
              <div class="bar-wrap">
                <div class="bar-val">24</div>
                <div class="bar" style="height:80%; opacity:1;"></div>
                <div class="bar-label" style="font-weight:600;color:var(--accent)">Feb</div>
              </div>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <div class="card-title">Alertas activas</div>
            <span class="badge badge-alto">3 crÃ­ticas</span>
          </div>
          <div class="card-body" style="padding:14px 16px;">
            <div class="alert-list">
              <div class="alert-item high" onclick="showPage('alertas')">
                <div class="alert-dot high"></div>
                <div class="alert-text">
                  <div class="alert-name">MatÃ­as R.</div>
                  <div class="alert-reason">Sin intervenciÃ³n hace 38 dÃ­as</div>
                </div>
                <div class="alert-time">hace 2h</div>
              </div>
              <div class="alert-item" onclick="showPage('alertas')">
                <div class="alert-dot"></div>
                <div class="alert-text">
                  <div class="alert-name">Valentina S.</div>
                  <div class="alert-reason">Asistencia escolar 62%</div>
                </div>
                <div class="alert-time">ayer</div>
              </div>
              <div class="alert-item" onclick="showPage('alertas')">
                <div class="alert-dot"></div>
                <div class="alert-text">
                  <div class="alert-name">Diego F.</div>
                  <div class="alert-reason">Control mÃ©dico vencido</div>
                </div>
                <div class="alert-time">3 dÃ­as</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">NNA Recientes</div>
          <button class="btn btn-outline btn-sm" onclick="showPage('nna')">Ver todos â†’</button>
        </div>
        <div class="card-body" style="padding:0 22px;">
          <div class="nna-list" id="dashboard-nna-list"></div>
        </div>
      </div>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ FICHAS NNA â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="page" id="page-nna">
      <div class="section-header">
        <div>
          <div class="section-title">Fichas NNA</div>
          <div class="section-sub" id="nna-count-label">18 niÃ±os, niÃ±as y adolescentes</div>
        </div>
        <div style="display:flex;gap:8px;">
          <button class="btn btn-outline" onclick="exportExcel()">ğŸ“¥ Excel</button>
          <button class="btn btn-primary" onclick="openModal('modal-nuevo-nna')">+ Nuevo NNA</button>
        </div>
      </div>

      <div class="filters-bar">
        <select class="filter-select" onchange="filterNNA(this.value)">
          <option value="">Todos los estados</option>
          <option value="activo">Activo</option>
          <option value="egreso">Egreso</option>
          <option value="suspension">SuspensiÃ³n</option>
        </select>
        <select class="filter-select">
          <option>Todos los profesionales</option>
          <option>Ana MartÃ­nez</option>
          <option>Carlos Vera</option>
        </select>
      </div>

      <div class="card">
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Nombre</th>
                <th>RUT</th>
                <th>Edad</th>
                <th>Ingreso</th>
                <th>Estado</th>
                <th>Riesgo</th>
                <th>Profesional</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="nna-table-body"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ FICHA INDIVIDUAL â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="page" id="page-ficha">
      <button class="btn btn-outline btn-sm" onclick="showPage('nna')" style="margin-bottom:16px;">â† Volver a fichas</button>

      <div class="ficha-header">
        <div class="ficha-avatar" id="ficha-avatar">MR</div>
        <div>
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px;">
            <div class="ficha-name" id="ficha-nombre">MatÃ­as RodrÃ­guez</div>
            <span class="badge badge-active" id="ficha-estado-badge">Activo</span>
          </div>
          <div class="ficha-meta">
            <div class="ficha-meta-item">ğŸ‚ <span id="ficha-edad">14 aÃ±os</span></div>
            <div class="ficha-meta-item">ğŸ“‹ <span id="ficha-rut">12.345.678-9</span></div>
            <div class="ficha-meta-item">ğŸ“… Ingreso: <span id="ficha-ingreso">12/03/2024</span></div>
            <div class="ficha-meta-item">ğŸ« <span id="ficha-escolaridad">8Â° BÃ¡sico</span></div>
          </div>
        </div>
        <div class="ficha-actions">
          <button class="btn btn-outline btn-sm" onclick="generatePDF()">ğŸ“„ Generar PDF</button>
          <button class="btn btn-primary btn-sm" onclick="openModal('modal-nueva-intervencion')">+ IntervenciÃ³n</button>
        </div>
      </div>

      <div class="tabs">
        <div class="tab active" onclick="switchTab(this, 'tab-datos')">Datos personales</div>
        <div class="tab" onclick="switchTab(this, 'tab-plan')">Plan de trabajo</div>
        <div class="tab" onclick="switchTab(this, 'tab-intervenciones')">Intervenciones</div>
        <div class="tab" onclick="switchTab(this, 'tab-diario')">Registro diario</div>
        <div class="tab" onclick="switchTab(this, 'tab-docs')">Documentos</div>
      </div>

      <!-- TAB DATOS -->
      <div class="tab-content active" id="tab-datos">
        <div class="card">
          <div class="card-header">
            <div class="card-title">InformaciÃ³n del NNA</div>
            <button class="btn btn-outline btn-sm" onclick="openModal('modal-editar-nna')">âœï¸ Editar</button>
          </div>
          <div class="card-body">
            <div class="form-grid">
              <div class="form-group">
                <label>Nombre completo</label>
                <input type="text" id="edit-nombre" value="MatÃ­as Alejandro RodrÃ­guez PÃ©rez" readonly/>
              </div>
              <div class="form-group">
                <label>RUT</label>
                <input type="text" value="12.345.678-9" readonly/>
              </div>
              <div class="form-group">
                <label>Fecha de nacimiento</label>
                <input type="text" value="15/04/2010" readonly/>
              </div>
              <div class="form-group">
                <label>Edad</label>
                <input type="text" value="14 aÃ±os" readonly/>
              </div>
              <div class="form-group">
                <label>Nacionalidad</label>
                <input type="text" value="Chilena" readonly/>
              </div>
              <div class="form-group">
                <label>SituaciÃ³n migratoria</label>
                <input type="text" value="N/A" readonly/>
              </div>
              <div class="form-group">
                <label>Fecha ingreso</label>
                <input type="text" value="12/03/2024" readonly/>
              </div>
              <div class="form-group">
                <label>Escolaridad</label>
                <input type="text" value="8Â° BÃ¡sico â€” Escuela RepÃºblica de Chile" readonly/>
              </div>
              <div class="form-group">
                <label>DiagnÃ³stico relevante</label>
                <input type="text" value="TDAH, trastorno del sueÃ±o" readonly/>
              </div>
              <div class="form-group">
                <label>Adulto responsable</label>
                <input type="text" value="MarÃ­a PÃ©rez (madre) - 9 8765 4321" readonly/>
              </div>
              <div class="form-group">
                <label>Tribunal derivante</label>
                <input type="text" value="Juzgado de Familia de Santiago" readonly/>
              </div>
              <div class="form-group">
                <label>Estado del caso</label>
                <input type="text" value="Activo" readonly/>
              </div>
              <div class="form-group full">
                <label>Observaciones</label>
                <textarea readonly>MatÃ­as presenta dificultades de integraciÃ³n con pares. Se han establecido estrategias de contenciÃ³n emocional. Mantiene buena relaciÃ³n con el equipo de monitores.</textarea>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- TAB PLAN -->
      <div class="tab-content" id="tab-plan">
        <div class="section-header">
          <div class="section-title" style="font-size:16px;">Plan de Trabajo Familiar</div>
          <button class="btn btn-primary btn-sm">+ Agregar objetivo</button>
        </div>

        <div class="plan-section">
          <div class="plan-section-header">
            <div class="plan-section-title">
              <div class="plan-icon" style="background:rgba(42,127,255,0.12)">ğŸ’°</div>
              Plan de Ahorro Familiar
            </div>
            <span class="badge badge-blue">68% cumplimiento</span>
          </div>
          <div class="progress-row">
            <div class="progress-label">Meta mensual</div>
            <div class="progress-bar-wrap"><div class="progress-bar-fill" style="width:68%"></div></div>
            <div class="progress-pct">68%</div>
          </div>
          <div class="objetivo-item">
            <div class="objetivo-status status-progreso"></div>
            <div>
              <div class="objetivo-text">Ahorrar $50.000 mensuales en cuenta familiar</div>
              <div class="objetivo-dates">Inicio: 01/01/2025 Â· RevisiÃ³n: 31/03/2025</div>
            </div>
            <span class="badge badge-blue">En progreso</span>
          </div>
          <div class="objetivo-item">
            <div class="objetivo-status status-cumplido"></div>
            <div>
              <div class="objetivo-text">Apertura de cuenta de ahorro</div>
              <div class="objetivo-dates">Completado: 15/01/2025</div>
            </div>
            <span class="badge badge-active">Cumplido</span>
          </div>
        </div>

        <div class="plan-section">
          <div class="plan-section-header">
            <div class="plan-section-title">
              <div class="plan-icon" style="background:rgba(46,158,107,0.12)">ğŸ¥</div>
              Salud y NutriciÃ³n
            </div>
            <span class="badge badge-active">Al dÃ­a</span>
          </div>
          <div class="progress-row">
            <div class="progress-label">Controles mÃ©dicos</div>
            <div class="progress-bar-wrap"><div class="progress-bar-fill success" style="width:100%"></div></div>
            <div class="progress-pct">100%</div>
          </div>
          <div class="objetivo-item">
            <div class="objetivo-status status-cumplido"></div>
            <div>
              <div class="objetivo-text">Control mÃ©dico mensual â€” Dr. Soto, Centro de Salud El Bosque</div>
              <div class="objetivo-dates">Ãšltimo: 02/02/2025 Â· PrÃ³ximo: 04/03/2025</div>
            </div>
            <span class="badge badge-active">Al dÃ­a</span>
          </div>
          <div class="objetivo-item">
            <div class="objetivo-status status-progreso"></div>
            <div>
              <div class="objetivo-text">Control nutricional trimestral</div>
              <div class="objetivo-dates">PrÃ³ximo: 15/03/2025</div>
            </div>
            <span class="badge badge-blue">En progreso</span>
          </div>
        </div>

        <div class="plan-section">
          <div class="plan-section-header">
            <div class="plan-section-title">
              <div class="plan-icon" style="background:rgba(232,160,32,0.12)">ğŸ’</div>
              Escolaridad
            </div>
            <span class="badge badge-medio">62% asistencia</span>
          </div>
          <div class="progress-row">
            <div class="progress-label">Asistencia</div>
            <div class="progress-bar-wrap"><div class="progress-bar-fill warning" style="width:62%"></div></div>
            <div class="progress-pct">62%</div>
          </div>
          <div class="objetivo-item">
            <div class="objetivo-status status-pendiente"></div>
            <div>
              <div class="objetivo-text">Mejorar asistencia a 80% â€” requiere intervenciÃ³n</div>
              <div class="objetivo-dates">Inicio: 01/02/2025 Â· RevisiÃ³n: 28/02/2025</div>
            </div>
            <span class="badge badge-alto">âš ï¸ Alerta</span>
          </div>
        </div>
      </div>

      <!-- TAB INTERVENCIONES -->
      <div class="tab-content" id="tab-intervenciones">
        <div class="section-header">
          <div class="section-title" style="font-size:16px;">Historial de Intervenciones</div>
          <button class="btn btn-primary btn-sm" onclick="openModal('modal-nueva-intervencion')">+ Nueva</button>
        </div>

        <div class="intervencion-card alto">
          <div class="intervencion-header">
            <div class="intervencion-tipo">ğŸ§  IntervenciÃ³n Psicosocial</div>
            <span class="badge badge-alto">Riesgo Alto</span>
            <div class="intervencion-fecha">12/02/2025</div>
          </div>
          <div class="intervencion-profesional">ğŸ‘¤ Ana MartÃ­nez (Trabajadora Social)</div>
          <div class="intervencion-desc">Se realizÃ³ sesiÃ³n individual con MatÃ­as ante episodio de agresividad reportado por monitor nocturno. Se trabajaron tÃ©cnicas de regulaciÃ³n emocional. MatÃ­as reconoce dificultades con el control de impulsos.</div>
          <div class="intervencion-tags">
            <span class="badge badge-alto">Acuerdos: Asistir a taller de habilidades blandas</span>
          </div>
        </div>

        <div class="intervencion-card medio">
          <div class="intervencion-header">
            <div class="intervencion-tipo">ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦ IntervenciÃ³n Familiar</div>
            <span class="badge badge-medio">Riesgo Medio</span>
            <div class="intervencion-fecha">28/01/2025</div>
          </div>
          <div class="intervencion-profesional">ğŸ‘¤ Carlos Vera (PsicÃ³logo)</div>
          <div class="intervencion-desc">ReuniÃ³n con madre MarÃ­a PÃ©rez. Se abordÃ³ la situaciÃ³n habitacional de la familia y las condiciones para el eventual egreso. La madre muestra disposiciÃ³n pero requiere apoyo econÃ³mico.</div>
          <div class="intervencion-tags">
            <span class="badge badge-medio">PrÃ³ximos pasos: Postular a subsidio habitacional</span>
          </div>
        </div>

        <div class="intervencion-card bajo">
          <div class="intervencion-header">
            <div class="intervencion-tipo">ğŸ« IntervenciÃ³n Educativa</div>
            <span class="badge badge-bajo">Riesgo Bajo</span>
            <div class="intervencion-fecha">15/01/2025</div>
          </div>
          <div class="intervencion-profesional">ğŸ‘¤ Ana MartÃ­nez (Trabajadora Social)</div>
          <div class="intervencion-desc">Contacto con escuela RepÃºblica de Chile. Se coordinÃ³ con la profesora jefe para implementar adaptaciones curriculares por el TDAH de MatÃ­as. Se firmÃ³ protocolo de comunicaciÃ³n mensual.</div>
          <div class="intervencion-tags">
            <span class="badge badge-bajo">Seguimiento: ReuniÃ³n mensual con escuela</span>
          </div>
        </div>
      </div>

      <!-- TAB DIARIO -->
      <div class="tab-content" id="tab-diario">
        <div class="section-header">
          <div class="section-title" style="font-size:16px;">Registro Diario</div>
          <button class="btn btn-primary btn-sm" onclick="openModal('modal-registro-diario')">+ Registro hoy</button>
        </div>

        <div class="registro-card">
          <div class="registro-date">ğŸ“… Lunes 12 de febrero, 2025 â€” Monitor: Pedro NÃºÃ±ez</div>
          <div class="registro-grid">
            <div>
              <div class="registro-field-label">Conducta</div>
              <div class="registro-field-val">Irritable al inicio del dÃ­a. MejorÃ³ hacia la tarde tras actividad deportiva.</div>
            </div>
            <div>
              <div class="registro-field-label">Actividades</div>
              <div class="registro-field-val">Taller de fÃºtbol, aseo de habitaciÃ³n, cena grupal.</div>
            </div>
            <div>
              <div class="registro-field-label">Incidentes</div>
              <div class="registro-field-val">DiscusiÃ³n con compaÃ±ero de habitaciÃ³n. Se mediÃ³ sin mayores consecuencias.</div>
            </div>
            <div>
              <div class="registro-field-label">Observaciones</div>
              <div class="registro-field-val">MatÃ­as solicitÃ³ llamar a su madre. Se coordinÃ³ llamada para el dÃ­a siguiente.</div>
            </div>
          </div>
          <div class="alerta-urgente">âš ï¸ Alerta registrada: Episodio de agresividad verbal â€” derivado a profesional</div>
        </div>

        <div class="registro-card">
          <div class="registro-date">ğŸ“… Domingo 11 de febrero, 2025 â€” Monitor: Luisa Rojas</div>
          <div class="registro-grid">
            <div>
              <div class="registro-field-label">Conducta</div>
              <div class="registro-field-val">Tranquilo y participativo.</div>
            </div>
            <div>
              <div class="registro-field-label">Actividades</div>
              <div class="registro-field-val">DÃ­a libre, televisiÃ³n, juegos de mesa con pares.</div>
            </div>
            <div>
              <div class="registro-field-label">Incidentes</div>
              <div class="registro-field-val">Sin incidentes.</div>
            </div>
            <div>
              <div class="registro-field-label">Observaciones</div>
              <div class="registro-field-val">Buen fin de semana. Se observa mejorÃ­a en relaciÃ³n con pares.</div>
            </div>
          </div>
        </div>
      </div>

      <!-- TAB DOCS -->
      <div class="tab-content" id="tab-docs">
        <div class="section-header">
          <div class="section-title" style="font-size:16px;">Documentos</div>
          <button class="btn btn-primary btn-sm" onclick="openModal('modal-subir-doc')">+ Subir documento</button>
        </div>
        <div class="doc-grid">
          <div class="doc-card">
            <div class="doc-icon">ğŸ“„</div>
            <div class="doc-name">ResoluciÃ³n Tribunal.pdf</div>
            <div class="doc-date">10/03/2024</div>
          </div>
          <div class="doc-card">
            <div class="doc-icon">ğŸ“‹</div>
            <div class="doc-name">Informe Ingreso.pdf</div>
            <div class="doc-date">12/03/2024</div>
          </div>
          <div class="doc-card">
            <div class="doc-icon">ğŸ¥</div>
            <div class="doc-name">Control MÃ©dico Feb.pdf</div>
            <div class="doc-date">02/02/2025</div>
          </div>
          <div class="doc-card">
            <div class="doc-icon">ğŸ’</div>
            <div class="doc-name">Informe Escolar.pdf</div>
            <div class="doc-date">31/01/2025</div>
          </div>
          <div class="doc-card" onclick="showToast('Subir nuevo documento', 'success')" style="border-style:dashed; opacity:0.6;">
            <div class="doc-icon">â•</div>
            <div class="doc-name">Agregar</div>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ INTERVENCIONES â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="page" id="page-intervenciones">
      <div class="section-header">
        <div>
          <div class="section-title">Intervenciones</div>
          <div class="section-sub">Historial global de intervenciones</div>
        </div>
        <button class="btn btn-primary" onclick="openModal('modal-nueva-intervencion')">+ Nueva intervenciÃ³n</button>
      </div>

      <div class="filters-bar">
        <select class="filter-select">
          <option>Todos los tipos</option>
          <option>Psicosocial</option>
          <option>Educativa</option>
          <option>Familiar</option>
          <option>Judicial</option>
          <option>Salud</option>
        </select>
        <select class="filter-select">
          <option>Todos los niveles</option>
          <option>Alto</option>
          <option>Medio</option>
          <option>Bajo</option>
        </select>
        <input type="month" style="border:1px solid var(--border);border-radius:var(--radius-sm);padding:7px 12px;font-size:13px;background:white;color:var(--text-mid);" value="2025-02"/>
      </div>

      <div class="card">
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>NNA</th>
                <th>Tipo</th>
                <th>Profesional</th>
                <th>Fecha</th>
                <th>Nivel riesgo</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="int-table-body"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ SEGUIMIENTO â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="page" id="page-seguimiento">
      <div class="section-header">
        <div>
          <div class="section-title">Seguimiento Diario</div>
          <div class="section-sub">Registros del dÃ­a por monitor</div>
        </div>
        <button class="btn btn-primary" onclick="openModal('modal-registro-diario')">+ Nuevo registro</button>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">ğŸ“… Hoy â€” 12 de febrero, 2025</div>
          <span class="badge badge-blue">4 registros</span>
        </div>
        <div class="card-body" style="padding:0 22px;">
          <div class="nna-list" id="seguimiento-list"></div>
        </div>
      </div>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ ALERTAS â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="page" id="page-alertas">
      <div class="section-header">
        <div>
          <div class="section-title">Sistema de Alertas</div>
          <div class="section-sub">3 alertas activas requieren atenciÃ³n</div>
        </div>
      </div>

      <div class="card" style="margin-bottom:16px;">
        <div class="card-header">
          <div class="card-title">ğŸ”´ Alertas crÃ­ticas</div>
          <span class="badge badge-alto">1 alerta</span>
        </div>
        <div class="card-body" style="padding:12px 16px;">
          <div class="alert-list">
            <div class="alert-item high" onclick="openFicha(nnaData[0])">
              <div class="alert-dot high"></div>
              <div class="alert-text">
                <div class="alert-name">MatÃ­as RodrÃ­guez â€” Sin intervenciÃ³n hace 38 dÃ­as</div>
                <div class="alert-reason">El protocolo exige intervenciÃ³n mÃ­nima cada 30 dÃ­as. Ãšltimo registro: 05/01/2025</div>
              </div>
              <button class="btn btn-danger btn-sm" onclick="event.stopPropagation(); openModal('modal-nueva-intervencion')">Intervenir</button>
            </div>
          </div>
        </div>
      </div>

      <div class="card" style="margin-bottom:16px;">
        <div class="card-header">
          <div class="card-title">ğŸŸ¡ Alertas de seguimiento</div>
          <span class="badge badge-medio">2 alertas</span>
        </div>
        <div class="card-body" style="padding:12px 16px;">
          <div class="alert-list">
            <div class="alert-item">
              <div class="alert-dot"></div>
              <div class="alert-text">
                <div class="alert-name">Valentina Soto â€” Asistencia escolar 62%</div>
                <div class="alert-reason">Por debajo del umbral mÃ­nimo (70%). Requiere coordinaciÃ³n con escuela.</div>
              </div>
              <button class="btn btn-outline btn-sm" onclick="event.stopPropagation(); showToast('Alerta marcada como revisada', 'success')">Revisar</button>
            </div>
            <div class="alert-item">
              <div class="alert-dot"></div>
              <div class="alert-text">
                <div class="alert-name">Diego Fuentes â€” Control mÃ©dico vencido</div>
                <div class="alert-reason">El Ãºltimo control fue el 28/11/2024. Debe reagendarse.</div>
              </div>
              <button class="btn btn-outline btn-sm" onclick="event.stopPropagation(); showToast('Recordatorio enviado al profesional', 'success')">Notificar</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ REPORTES â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="page" id="page-reportes">
      <div class="section-header">
        <div>
          <div class="section-title">Reportes</div>
          <div class="section-sub">Generar y exportar documentaciÃ³n institucional</div>
        </div>
      </div>

      <div class="grid-2" style="margin-bottom:16px;">
        <div class="card" style="cursor:pointer;" onclick="generatePDF()">
          <div class="card-body" style="text-align:center;padding:32px;">
            <div style="font-size:40px;margin-bottom:12px;">ğŸ“„</div>
            <div style="font-size:16px;font-weight:600;margin-bottom:6px;">Reporte Individual NNA</div>
            <div style="font-size:13px;color:var(--text-soft);margin-bottom:16px;">Ficha completa, intervenciones y plan de trabajo en PDF</div>
            <button class="btn btn-primary">Generar PDF</button>
          </div>
        </div>
        <div class="card" style="cursor:pointer;" onclick="exportExcel()">
          <div class="card-body" style="text-align:center;padding:32px;">
            <div style="font-size:40px;margin-bottom:12px;">ğŸ“Š</div>
            <div style="font-size:16px;font-weight:600;margin-bottom:6px;">Reporte Global</div>
            <div style="font-size:13px;color:var(--text-soft);margin-bottom:16px;">Exportar todos los NNA activos a Excel</div>
            <button class="btn btn-success">Exportar Excel</button>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <div class="card-title">Historial de reportes generados</div>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Reporte</th>
                <th>Tipo</th>
                <th>Generado por</th>
                <th>Fecha</th>
                <th>AcciÃ³n</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><div class="td-name">MatÃ­as RodrÃ­guez â€” Ene 2025</div></td>
                <td><span class="badge badge-blue">Individual</span></td>
                <td>Ana MartÃ­nez</td>
                <td>31/01/2025</td>
                <td><button class="btn btn-outline btn-sm" onclick="generatePDF()">ğŸ“¥ Descargar</button></td>
              </tr>
              <tr>
                <td><div class="td-name">Reporte Global â€” Ene 2025</div></td>
                <td><span class="badge badge-active">Global</span></td>
                <td>Ana MartÃ­nez</td>
                <td>31/01/2025</td>
                <td><button class="btn btn-outline btn-sm" onclick="exportExcel()">ğŸ“¥ Descargar</button></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ USUARIOS â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="page" id="page-usuarios">
      <div class="section-header">
        <div>
          <div class="section-title">GestiÃ³n de Usuarios</div>
          <div class="section-sub">3 usuarios registrados</div>
        </div>
        <button class="btn btn-primary" onclick="openModal('modal-nuevo-usuario')">+ Nuevo usuario</button>
      </div>

      <div class="card">
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Usuario</th>
                <th>Email</th>
                <th>Rol</th>
                <th>Estado</th>
                <th>Creado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>
                  <div style="display:flex;align-items:center;gap:10px;">
                    <div class="user-table-avatar">AM</div>
                    <div class="td-name">Ana MartÃ­nez</div>
                  </div>
                </td>
                <td><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ceafaaa3a7a08ebcabbda7aaaba0ada7afe0ada2">[email&#160;protected]</a></td>
                <td><span class="role-badge role-admin">Administrador</span></td>
                <td><span class="badge badge-active">Activo</span></td>
                <td>01/01/2025</td>
                <td><div class="action-btns"><button class="btn btn-outline btn-sm">âœï¸</button><button class="btn btn-danger btn-sm">ğŸ—‘ï¸</button></div></td>
              </tr>
              <tr>
                <td>
                  <div style="display:flex;align-items:center;gap:10px;">
                    <div class="user-table-avatar">CV</div>
                    <div class="td-name">Carlos Vera</div>
                  </div>
                </td>
                <td><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="364245764453455f525358555f5718555a">[email&#160;protected]</a></td>
                <td><span class="role-badge role-profesional">Profesional</span></td>
                <td><span class="badge badge-active">Activo</span></td>
                <td>05/01/2025</td>
                <td><div class="action-btns"><button class="btn btn-outline btn-sm">âœï¸</button><button class="btn btn-danger btn-sm">ğŸ—‘ï¸</button></div></td>
              </tr>
              <tr>
                <td>
                  <div style="display:flex;align-items:center;gap:10px;">
                    <div class="user-table-avatar">PN</div>
                    <div class="td-name">Pedro NÃºÃ±ez</div>
                  </div>
                </td>
                <td><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="670a08090e130815271502140e030209040e0649040b">[email&#160;protected]</a></td>
                <td><span class="role-badge role-monitor">Monitor</span></td>
                <td><span class="badge badge-active">Activo</span></td>
                <td>10/01/2025</td>
                <td><div class="action-btns"><button class="btn btn-outline btn-sm">âœï¸</button><button class="btn btn-danger btn-sm">ğŸ—‘ï¸</button></div></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <div class="page" id="page-config">
      <div class="section-header">
        <div class="section-title">ConfiguraciÃ³n</div>
      </div>
      <div class="card" style="max-width:600px;">
        <div class="card-header"><div class="card-title">âš™ï¸ ParÃ¡metros del sistema</div></div>
        <div class="card-body">
          <div class="form-grid">
            <div class="form-group full">
              <label>Nombre de la residencia</label>
              <input type="text" value="Residencia Los Arrayanes"/>
            </div>
            <div class="form-group">
              <label>DÃ­as sin intervenciÃ³n para alerta</label>
              <input type="number" value="30"/>
            </div>
            <div class="form-group">
              <label>% mÃ­nimo asistencia escolar</label>
              <input type="number" value="70"/>
            </div>
            <div class="form-group full">
              <label>Email administrador</label>
              <input type="email" value="admin@residencia.cl"/>
            </div>
          </div>
          <div class="form-actions">
            <button class="btn btn-primary" onclick="showToast('ConfiguraciÃ³n guardada', 'success')">Guardar cambios</button>
          </div>
        </div>
      </div>
    </div>

  </div><!-- end page-content -->
</div><!-- end main -->

<!-- â•â•â• MODALES â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- Modal: Nuevo NNA -->
<div class="modal-overlay" id="modal-nuevo-nna">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Nuevo NNA</div>
      <button class="modal-close" onclick="closeModal('modal-nuevo-nna')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group full"><label>Nombre completo *</label><input type="text" placeholder="Nombre y apellidos"/></div>
        <div class="form-group"><label>RUT *</label><input type="text" placeholder="12.345.678-9"/></div>
        <div class="form-group"><label>Fecha de nacimiento *</label><input type="date"/></div>
        <div class="form-group"><label>Nacionalidad *</label>
          <select><option>Chilena</option><option>Venezuela</option><option>Colombia</option><option>PerÃº</option><option>Otra</option></select>
        </div>
        <div class="form-group"><label>SituaciÃ³n migratoria</label><input type="text" placeholder="N/A o descripciÃ³n"/></div>
        <div class="form-group"><label>Fecha ingreso *</label><input type="date"/></div>
        <div class="form-group"><label>Escolaridad *</label>
          <select><option>PrebÃ¡sica</option><option>1Â° BÃ¡sico</option><option>2Â° BÃ¡sico</option><option>3Â° BÃ¡sico</option><option>4Â° BÃ¡sico</option><option>5Â° BÃ¡sico</option><option>6Â° BÃ¡sico</option><option>7Â° BÃ¡sico</option><option>8Â° BÃ¡sico</option><option>1Â° Medio</option><option>2Â° Medio</option><option>3Â° Medio</option><option>4Â° Medio</option></select>
        </div>
        <div class="form-group"><label>Adulto responsable</label><input type="text" placeholder="Nombre y telÃ©fono"/></div>
        <div class="form-group"><label>Tribunal derivante</label><input type="text" placeholder="Nombre del tribunal"/></div>
        <div class="form-group"><label>Estado inicial</label>
          <select><option value="activo">Activo</option><option value="egreso">Egreso</option><option value="suspension">SuspensiÃ³n</option></select>
        </div>
        <div class="form-group full"><label>DiagnÃ³stico relevante</label><input type="text" placeholder="DiagnÃ³sticos mÃ©dicos o psicolÃ³gicos"/></div>
        <div class="form-group full"><label>Observaciones</label><textarea placeholder="Observaciones iniciales..."></textarea></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modal-nuevo-nna')">Cancelar</button>
      <button class="btn btn-primary" onclick="saveNNA()">Guardar NNA</button>
    </div>
  </div>
</div>

<!-- Modal: Nueva IntervenciÃ³n -->
<div class="modal-overlay" id="modal-nueva-intervencion">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Nueva IntervenciÃ³n</div>
      <button class="modal-close" onclick="closeModal('modal-nueva-intervencion')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group full"><label>NNA</label>
          <select id="int-nna-select">
            <option>MatÃ­as RodrÃ­guez</option>
            <option>Valentina Soto</option>
            <option>Diego Fuentes</option>
          </select>
        </div>
        <div class="form-group"><label>Tipo *</label>
          <select><option>Psicosocial</option><option>Educativa</option><option>Familiar</option><option>Judicial</option><option>Salud</option></select>
        </div>
        <div class="form-group"><label>Nivel de riesgo *</label>
          <select><option value="bajo">Bajo</option><option value="medio">Medio</option><option value="alto">Alto</option></select>
        </div>
        <div class="form-group full"><label>DescripciÃ³n detallada *</label><textarea placeholder="Describe la intervenciÃ³n realizada..."></textarea></div>
        <div class="form-group full"><label>Acuerdos</label><textarea placeholder="Acuerdos establecidos con NNA/familia..."></textarea></div>
        <div class="form-group full"><label>PrÃ³ximos pasos</label><textarea placeholder="Acciones a seguir..."></textarea></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modal-nueva-intervencion')">Cancelar</button>
      <button class="btn btn-primary" onclick="saveIntervencion()">Registrar intervenciÃ³n</button>
    </div>
  </div>
</div>

<!-- Modal: Registro Diario -->
<div class="modal-overlay" id="modal-registro-diario">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Registro Diario</div>
      <button class="modal-close" onclick="closeModal('modal-registro-diario')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group full"><label>NNA</label>
          <select><option>MatÃ­as RodrÃ­guez</option><option>Valentina Soto</option><option>Diego Fuentes</option></select>
        </div>
        <div class="form-group full"><label>Conducta</label><textarea placeholder="DescripciÃ³n del comportamiento durante el dÃ­a..."></textarea></div>
        <div class="form-group full"><label>Actividades realizadas</label><textarea placeholder="Actividades en las que participÃ³..."></textarea></div>
        <div class="form-group full"><label>Incidentes</label><textarea placeholder="Incidentes ocurridos o 'Sin incidentes'..."></textarea></div>
        <div class="form-group full"><label>Observaciones adicionales</label><textarea placeholder="Otras observaciones relevantes..."></textarea></div>
        <div class="form-group full">
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
            <input type="checkbox" id="alerta-urgente-check" style="width:auto;"/>
            <span style="color:var(--danger);font-weight:600;">âš ï¸ Registrar alerta urgente</span>
          </label>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modal-registro-diario')">Cancelar</button>
      <button class="btn btn-primary" onclick="saveRegistro()">Guardar registro</button>
    </div>
  </div>
</div>

<!-- Modal: Subir Doc -->
<div class="modal-overlay" id="modal-subir-doc">
  <div class="modal" style="max-width:460px;">
    <div class="modal-header">
      <div class="modal-title">Subir documento</div>
      <button class="modal-close" onclick="closeModal('modal-subir-doc')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group full"><label>Tipo de documento</label>
          <select><option>ResoluciÃ³n judicial</option><option>Informe mÃ©dico</option><option>Informe escolar</option><option>Informe social</option><option>Otro</option></select>
        </div>
        <div class="form-group full"><label>DescripciÃ³n</label><input type="text" placeholder="DescripciÃ³n breve del documento"/></div>
        <div class="form-group full"><label>Archivo</label><input type="file" accept=".pdf,.doc,.docx"/></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modal-subir-doc')">Cancelar</button>
      <button class="btn btn-primary" onclick="showToast('Documento subido exitosamente', 'success'); closeModal('modal-subir-doc')">Subir</button>
    </div>
  </div>
</div>

<!-- Modal: Nuevo Usuario -->
<div class="modal-overlay" id="modal-nuevo-usuario">
  <div class="modal" style="max-width:480px;">
    <div class="modal-header">
      <div class="modal-title">Nuevo usuario</div>
      <button class="modal-close" onclick="closeModal('modal-nuevo-usuario')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group full"><label>Nombre completo</label><input type="text" placeholder="Nombre y apellidos"/></div>
        <div class="form-group full"><label>Correo electrÃ³nico</label><input type="email" placeholder="usuario@residencia.cl"/></div>
        <div class="form-group"><label>ContraseÃ±a</label><input type="password" placeholder="MÃ­nimo 8 caracteres"/></div>
        <div class="form-group"><label>Rol</label>
          <select><option value="admin">Administrador</option><option value="profesional">Profesional</option><option value="monitor">Monitor</option></select>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modal-nuevo-usuario')">Cancelar</button>
      <button class="btn btn-primary" onclick="showToast('Usuario creado exitosamente', 'success'); closeModal('modal-nuevo-usuario')">Crear usuario</button>
    </div>
  </div>
</div>

<!-- Toast container -->
<div class="toast-container" id="toast-container"></div>

<!-- â•â•â• JAVASCRIPT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
// â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const nnaData = [
  { id:1, nombre:"MatÃ­as RodrÃ­guez", rut:"12.345.678-9", edad:14, ingreso:"12/03/2024", estado:"activo", riesgo:"alto", profesional:"Ana MartÃ­nez", iniciales:"MR" },
  { id:2, nombre:"Valentina Soto", rut:"13.456.789-0", edad:12, ingreso:"05/06/2024", estado:"activo", riesgo:"medio", profesional:"Carlos Vera", iniciales:"VS" },
  { id:3, nombre:"Diego Fuentes", rut:"14.567.890-1", edad:16, ingreso:"22/01/2024", estado:"activo", riesgo:"bajo", profesional:"Ana MartÃ­nez", iniciales:"DF" },
  { id:4, nombre:"Camila Torres", rut:"15.678.901-2", edad:10, ingreso:"30/09/2024", estado:"activo", riesgo:"bajo", profesional:"Carlos Vera", iniciales:"CT" },
  { id:5, nombre:"JosÃ© HernÃ¡ndez", rut:"16.789.012-3", edad:15, ingreso:"14/07/2023", estado:"egreso", riesgo:"bajo", profesional:"Ana MartÃ­nez", iniciales:"JH" },
  { id:6, nombre:"Andrea MuÃ±oz", rut:"17.890.123-4", edad:13, ingreso:"03/11/2024", estado:"activo", riesgo:"medio", profesional:"Carlos Vera", iniciales:"AM" },
  { id:7, nombre:"Felipe Morales", rut:"18.901.234-5", edad:17, ingreso:"28/02/2024", estado:"suspension", riesgo:"alto", profesional:"Ana MartÃ­nez", iniciales:"FM" },
];

const intervencionesData = [
  { nna:"MatÃ­as RodrÃ­guez", tipo:"Psicosocial", profesional:"Ana MartÃ­nez", fecha:"12/02/2025", riesgo:"alto" },
  { nna:"Valentina Soto", tipo:"Educativa", profesional:"Carlos Vera", fecha:"10/02/2025", riesgo:"medio" },
  { nna:"Diego Fuentes", tipo:"Salud", profesional:"Ana MartÃ­nez", fecha:"08/02/2025", riesgo:"bajo" },
  { nna:"Camila Torres", tipo:"Familiar", profesional:"Carlos Vera", fecha:"05/02/2025", riesgo:"bajo" },
  { nna:"Andrea MuÃ±oz", tipo:"Judicial", profesional:"Carlos Vera", fecha:"01/02/2025", riesgo:"medio" },
];

const seguimientoData = [
  { nna:"MatÃ­as RodrÃ­guez", iniciales:"MR", monitor:"Pedro NÃºÃ±ez", conducta:"Irritable", incidente:"SÃ­" },
  { nna:"Valentina Soto", iniciales:"VS", monitor:"Luisa Rojas", conducta:"Tranquila", incidente:"No" },
  { nna:"Diego Fuentes", iniciales:"DF", monitor:"Pedro NÃºÃ±ez", conducta:"Normal", incidente:"No" },
  { nna:"Camila Torres", iniciales:"CT", monitor:"Luisa Rojas", conducta:"Alegre", incidente:"No" },
];

// â”€â”€â”€ AUTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let currentUser = null;

function quickLogin(email, pass, role) {
  document.getElementById('login-email').value = email;
  document.getElementById('login-pass').value = pass;
  doLogin();
}

const BACKEND_URL = "https://residencia-nna-production.up.railway.app";

async function doLogin() {
  const email = document.getElementById('login-email').value;
  const pass = document.getElementById('login-pass').value;
  
  if (!email || !pass) { showToast('Completa todos los campos', 'error'); return; }

  showToast('Iniciando sesiÃ³n...', 'info');

  try {
    const resp = await fetch(BACKEND_URL + '/api/auth/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password: pass })
    });

    if (!resp.ok) {
      const err = await resp.json();
      showToast(err.detail || 'Correo o contraseÃ±a incorrectos', 'error');
      return;
    }

    const data = await resp.json();
    localStorage.setItem('token', data.access_token);

    const u = data.user;
    const roleMap = { admin: 'Administrador', profesional: 'Profesional', monitor: 'Monitor' };
    const rolLabel = roleMap[u.rol] || u.rol;
    const initials = u.nombre.split(' ').map(n=>n[0]).join('').substring(0,2).toUpperCase();

    currentUser = { email: u.email, role: rolLabel, name: u.nombre, initials, token: data.access_token, rol: u.rol };

    document.getElementById('sidebar-name').textContent = u.nombre;
    document.getElementById('sidebar-role').textContent = rolLabel;
    document.getElementById('sidebar-avatar').textContent = initials;

    const adminItems = document.querySelectorAll('.admin-only');
    adminItems.forEach(el => {
      el.style.display = u.rol === 'admin' ? '' : 'none';
    });

    const login = document.getElementById('login-screen');
    login.classList.add('hidden');
    setTimeout(() => login.style.display = 'none', 400);

    renderAll();
    showToast(`Bienvenido/a, ${u.nombre}! âœ…`, 'success');

  } catch(e) {
    console.error(e);
    showToast('Error de conexiÃ³n con el servidor', 'error');
  }
}

function logout() {
  document.getElementById('login-screen').style.display = 'flex';
  document.getElementById('login-screen').classList.remove('hidden');
  currentUser = null;
}

// â”€â”€â”€ NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showPage(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

  const el = document.getElementById('page-' + page);
  if (el) el.classList.add('active');

  const titles = {
    dashboard: 'Dashboard',
    nna: 'Fichas NNA',
    intervenciones: 'Intervenciones',
    seguimiento: 'Seguimiento Diario',
    alertas: 'Alertas',
    reportes: 'Reportes',
    usuarios: 'Usuarios',
    config: 'ConfiguraciÃ³n',
    ficha: 'Ficha NNA'
  };
  document.getElementById('page-title').textContent = titles[page] || page;

  // active nav
  document.querySelectorAll('.nav-item').forEach(item => {
    if (item.getAttribute('onclick') && item.getAttribute('onclick').includes("'" + page + "'")) {
      item.classList.add('active');
    }
  });
}

function openFicha(nna) {
  document.getElementById('ficha-avatar').textContent = nna.iniciales;
  document.getElementById('ficha-nombre').textContent = nna.nombre;
  document.getElementById('ficha-edad').textContent = nna.edad + ' aÃ±os';
  document.getElementById('ficha-rut').textContent = nna.rut;
  document.getElementById('ficha-ingreso').textContent = nna.ingreso;

  const estadoBadge = document.getElementById('ficha-estado-badge');
  estadoBadge.className = 'badge badge-' + nna.estado;
  estadoBadge.textContent = nna.estado.charAt(0).toUpperCase() + nna.estado.slice(1);

  showPage('ficha');
}

// â”€â”€â”€ TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTab(el, targetId) {
  el.parentElement.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');

  const parent = el.closest('.page');
  parent.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
  const target = document.getElementById(targetId);
  if (target) target.classList.add('active');
}

// â”€â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAll() {
  renderDashboardNNA();
  renderNNATable(nnaData);
  renderIntTable();
  renderSeguimiento();
}

function renderDashboardNNA() {
  const list = document.getElementById('dashboard-nna-list');
  const items = nnaData.filter(n => n.estado === 'activo').slice(0, 5);
  list.innerHTML = items.map(nna => `
    <div class="nna-item" onclick="openFicha(${JSON.stringify(nna).replace(/"/g,'&quot;')})">
      <div class="nna-avatar">${nna.iniciales}</div>
      <div class="nna-info">
        <div class="nna-name">${nna.nombre}</div>
        <div class="nna-meta">${nna.edad} aÃ±os Â· Ingreso ${nna.ingreso}</div>
      </div>
      <span class="badge badge-${nna.riesgo}">${riesgoLabel(nna.riesgo)}</span>
    </div>
  `).join('');
}

function renderNNATable(data) {
  const tbody = document.getElementById('nna-table-body');
  tbody.innerHTML = data.map(nna => `
    <tr>
      <td>
        <div style="display:flex;align-items:center;gap:10px;">
          <div class="nna-avatar">${nna.iniciales}</div>
          <div>
            <div class="td-name">${nna.nombre}</div>
            <div class="td-sub">${nna.rut}</div>
          </div>
        </div>
      </td>
      <td>${nna.rut}</td>
      <td>${nna.edad} aÃ±os</td>
      <td>${nna.ingreso}</td>
      <td><span class="badge badge-${nna.estado}">${estadoLabel(nna.estado)}</span></td>
      <td><span class="badge badge-${nna.riesgo}">${riesgoLabel(nna.riesgo)}</span></td>
      <td>${nna.profesional}</td>
      <td>
        <div class="action-btns">
          <button class="btn btn-outline btn-sm" onclick="openFicha(${JSON.stringify(nna).replace(/"/g,'&quot;')})">ğŸ‘ Ver</button>
          <button class="btn btn-outline btn-sm" onclick="openModal('modal-nueva-intervencion')">ğŸ“</button>
        </div>
      </td>
    </tr>
  `).join('');
}

function renderIntTable() {
  const tbody = document.getElementById('int-table-body');
  tbody.innerHTML = intervencionesData.map(i => `
    <tr>
      <td class="td-name">${i.nna}</td>
      <td><span class="badge badge-blue">${i.tipo}</span></td>
      <td>${i.profesional}</td>
      <td>${i.fecha}</td>
      <td><span class="badge badge-${i.riesgo}">${riesgoLabel(i.riesgo)}</span></td>
      <td>
        <div class="action-btns">
          <button class="btn btn-outline btn-sm">ğŸ‘ Ver</button>
        </div>
      </td>
    </tr>
  `).join('');
}

function renderSeguimiento() {
  const list = document.getElementById('seguimiento-list');
  list.innerHTML = seguimientoData.map(s => `
    <div class="nna-item" onclick="openFicha(nnaData[0])">
      <div class="nna-avatar">${s.iniciales}</div>
      <div class="nna-info">
        <div class="nna-name">${s.nna}</div>
        <div class="nna-meta">Monitor: ${s.monitor}</div>
      </div>
      <div style="display:flex;gap:8px;align-items:center;">
        <span class="badge ${s.incidente==='SÃ­' ? 'badge-alto' : 'badge-active'}">${s.incidente==='SÃ­' ? 'âš ï¸ Incidente' : 'âœ“ Sin incidentes'}</span>
        <span class="badge badge-blue">${s.conducta}</span>
      </div>
    </div>
  `).join('');
}

function estadoLabel(e) {
  return { activo: 'Activo', egreso: 'Egreso', suspension: 'SuspensiÃ³n' }[e] || e;
}
function riesgoLabel(r) {
  return { alto: 'Alto âš ï¸', medio: 'Medio', bajo: 'Bajo' }[r] || r;
}

// â”€â”€â”€ MODALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(id) {
  document.getElementById(id).classList.add('open');
}
function closeModal(id) {
  document.getElementById(id).classList.remove('open');
}

// close on overlay click
document.querySelectorAll('.modal-overlay').forEach(overlay => {
  overlay.addEventListener('click', e => {
    if (e.target === overlay) overlay.classList.remove('open');
  });
});

// â”€â”€â”€ FILTERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function filterNNA(estado) {
  const filtered = estado ? nnaData.filter(n => n.estado === estado) : nnaData;
  renderNNATable(filtered);
}

function handleSearch(val) {
  if (!val) { renderNNATable(nnaData); return; }
  const q = val.toLowerCase();
  const filtered = nnaData.filter(n =>
    n.nombre.toLowerCase().includes(q) || n.rut.includes(q)
  );
  renderNNATable(filtered);
}

// â”€â”€â”€ SAVE ACTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveNNA() {
  closeModal('modal-nuevo-nna');
  showToast('NNA registrado exitosamente âœ…', 'success');
}

function saveIntervencion() {
  closeModal('modal-nueva-intervencion');
  showToast('IntervenciÃ³n registrada âœ…', 'success');
}

function saveRegistro() {
  closeModal('modal-registro-diario');
  const alerta = document.getElementById('alerta-urgente-check').checked;
  showToast(alerta ? 'âš ï¸ Registro guardado con alerta urgente' : 'Registro guardado âœ…', alerta ? 'error' : 'success');
}

// â”€â”€â”€ PDF / EXCEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generatePDF() {
  showToast('Generando reporte PDF... ğŸ“„', 'success');
  setTimeout(() => showToast('PDF listo para descarga âœ…', 'success'), 1800);
}

function exportExcel() {
  // Simple CSV export
  const rows = [['Nombre', 'RUT', 'Edad', 'Ingreso', 'Estado', 'Riesgo', 'Profesional']];
  nnaData.forEach(n => rows.push([n.nombre, n.rut, n.edad, n.ingreso, n.estado, n.riesgo, n.profesional]));
  const csv = rows.map(r => r.join(',')).join('\n');
  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'NNA_Reporte.csv';
  a.click();
  showToast('Excel exportado âœ…', 'success');
}

// â”€â”€â”€ DARK MODE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let darkMode = false;
function toggleDarkMode() {
  darkMode = !darkMode;
  if (darkMode) {
    document.documentElement.style.setProperty('--mist', '#111827');
    document.documentElement.style.setProperty('--fog', '#1f2937');
    document.documentElement.style.setProperty('--white', '#1a2332');
    document.documentElement.style.setProperty('--border', '#2d3a4a');
    document.documentElement.style.setProperty('--text-main', '#e8eef5');
    document.documentElement.style.setProperty('--text-mid', '#94a3b8');
    showToast('Modo oscuro activado ğŸŒ™', 'success');
  } else {
    document.documentElement.style.setProperty('--mist', '#f4f7fb');
    document.documentElement.style.setProperty('--fog', '#e8eef5');
    document.documentElement.style.setProperty('--white', '#ffffff');
    document.documentElement.style.setProperty('--border', '#d0daea');
    document.documentElement.style.setProperty('--text-main', '#0f1f3d');
    document.documentElement.style.setProperty('--text-mid', '#4a5f7a');
    showToast('Modo claro activado â˜€ï¸', 'success');
  }
}

// â”€â”€â”€ TOAST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showToast(msg, type = '') {
  const container = document.getElementById('toast-container');
  const toast = document.createElement('div');
  toast.className = 'toast ' + type;
  toast.innerHTML = `<sp<script>
// â”€â”€â”€ TALLERES MODULE INJECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Add CSS for talleres
const talleresStyle = document.createElement('style');
talleresStyle.textContent = `
.taller-card {
  background: var(--white);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px 22px;
  margin-bottom: 14px;
  box-shadow: var(--shadow-sm);
  cursor: pointer;
  transition: all 0.2s;
  position: relative;
  overflow: hidden;
}
.taller-card::before {
  content:'';
  position:absolute;
  top:0;left:0;
  width:4px;height:100%;
  background: var(--accent);
}
.taller-card.parentalidad::before { background: #8b5cf6; }
.taller-card.autocuidado::before { background: var(--success); }
.taller-card.empleabilidad::before { background: var(--warning); }
.taller-card.educacion::before { background: var(--accent); }
.taller-card.salud::before { background: #ec4899; }
.taller-card:hover { box-shadow: var(--shadow-md); transform: translateY(-1px); }
.taller-header { display:flex; align-items:center; gap:12px; margin-bottom:10px; }
.taller-area-badge {
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.area-parentalidad { background: rgba(139,92,246,0.12); color:#8b5cf6; }
.area-autocuidado { background: rgba(46,158,107,0.12); color:var(--success); }
.area-empleabilidad { background: rgba(232,160,32,0.12); color:var(--warning); }
.area-educacion { background: rgba(42,127,255,0.12); color:var(--accent); }
.area-salud { background: rgba(236,72,153,0.12); color:#ec4899; }
.area-otro { background: rgba(96,125,156,0.12); color:var(--steel); }
.taller-title { font-size:15px; font-weight:600; color:var(--text-main); flex:1; }
.taller-meta { display:flex; gap:16px; font-size:12px; color:var(--text-soft); flex-wrap:wrap; }
.taller-meta span { display:flex; align-items:center; gap:4px; }
.subtabs { display:flex; gap:2px; background:var(--fog); border-radius:var(--radius-sm); padding:3px; margin-bottom:16px; overflow-x:auto; }
.subtab { padding:6px 14px; border-radius:6px; font-size:12px; font-weight:500; cursor:pointer; color:var(--text-soft); white-space:nowrap; transition:all 0.2s; }
.subtab.active { background:var(--white); color:var(--text-main); box-shadow:var(--shadow-sm); }
.diapositiva-card { background:var(--navy); color:white; border-radius:var(--radius); padding:32px; margin-bottom:12px; min-height:160px; display:flex; flex-direction:column; justify-content:center; }
.diapositiva-num { font-size:11px; opacity:0.5; margin-bottom:8px; text-transform:uppercase; letter-spacing:1px; }
.diapositiva-titulo { font-size:20px; font-weight:700; margin-bottom:12px; font-family:'DM Serif Display',serif; }
.diapositiva-content { font-size:13px; opacity:0.8; line-height:1.7; }
.asistente-row { display:flex; align-items:center; gap:12px; padding:12px 0; border-bottom:1px solid var(--fog); }
.asistente-row:last-child { border-bottom:none; }
.asistente-check { width:20px; height:20px; cursor:pointer; }
.asistente-name { flex:1; font-size:13px; font-weight:500; }
.asistente-obs { flex:2; }
.asistente-obs input { font-size:12px; padding:6px 10px; }
.archivo-item { display:flex; align-items:center; gap:12px; padding:12px 14px; background:var(--mist); border-radius:var(--radius-sm); margin-bottom:8px; }
.archivo-icon { font-size:24px; }
.archivo-info { flex:1; }
.archivo-name { font-size:13px; font-weight:500; }
.archivo-meta { font-size:11px; color:var(--text-soft); }
.stats-mini { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-bottom:16px; }
.stat-mini { background:var(--white); border:1px solid var(--border); border-radius:var(--radius-sm); padding:14px; text-align:center; }
.stat-mini-val { font-size:24px; font-weight:700; color:var(--text-main); font-family:'DM Serif Display',serif; }
.stat-mini-label { font-size:11px; color:var(--text-soft); margin-top:2px; }
`;
document.head.appendChild(talleresStyle);

// â”€â”€â”€ INJECT TALLERES NAV ITEM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const navSection = document.querySelector('.nav-section');
const talleresNav = document.createElement('a');
talleresNav.className = 'nav-item';
talleresNav.setAttribute('onclick', "showPage('talleres')");
talleresNav.innerHTML = '<span class="nav-icon">ğŸ“</span> Talleres';
navSection.appendChild(talleresNav);

// â”€â”€â”€ INJECT TALLERES PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const pageContent = document.querySelector('.page-content');
const talleresPage = document.createElement('div');
talleresPage.className = 'page';
talleresPage.id = 'page-talleres';
talleresPage.innerHTML = `
  <div class="section-header">
    <div>
      <div class="section-title">MÃ³dulo de Talleres</div>
      <div class="section-sub">Biblioteca institucional y registro de ejecuciones</div>
    </div>
    <button class="btn btn-primary" onclick="openModal('modal-nuevo-taller')">+ Nuevo taller</button>
  </div>

  <div class="stats-mini">
    <div class="stat-mini">
      <div class="stat-mini-val">6</div>
      <div class="stat-mini-label">Talleres en biblioteca</div>
    </div>
    <div class="stat-mini">
      <div class="stat-mini-val">14</div>
      <div class="stat-mini-label">Ejecuciones este mes</div>
    </div>
    <div class="stat-mini">
      <div class="stat-mini-val">87%</div>
      <div class="stat-mini-label">Asistencia promedio</div>
    </div>
  </div>

  <div class="tabs" style="margin-bottom:20px;">
    <div class="tab active" onclick="switchTallerTab(this,'taller-biblioteca')">ğŸ“š Biblioteca</div>
    <div class="tab" onclick="switchTallerTab(this,'taller-ejecuciones')">â–¶ï¸ Ejecuciones</div>
    <div class="tab" onclick="switchTallerTab(this,'taller-nuevo-ej')">+ Ejecutar</div>
  </div>

  <!-- BIBLIOTECA -->
  <div id="taller-biblioteca" class="tab-content active">
    <div id="talleres-list"></div>
  </div>

  <!-- EJECUCIONES -->
  <div id="taller-ejecuciones" class="tab-content">
    <div class="card">
      <div class="card-header"><div class="card-title">Historial de ejecuciones</div></div>
      <div class="table-wrap">
        <table>
          <thead><tr><th>Taller</th><th>Ãrea</th><th>Fecha</th><th>Asistentes</th><th>Profesional</th><th>Acciones</th></tr></thead>
          <tbody id="ejecuciones-table"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- EJECUTAR -->
  <div id="taller-nuevo-ej" class="tab-content">
    <div class="card">
      <div class="card-header"><div class="card-title">â–¶ï¸ Ejecutar Taller</div></div>
      <div class="card-body">
        <div class="form-grid">
          <div class="form-group full">
            <label>Seleccionar taller</label>
            <select id="ej-taller-select" onchange="loadTallerInfo(this.value)">
              <option value="">-- Elige un taller --</option>
            </select>
          </div>
          <div class="form-group"><label>Fecha</label><input type="date" id="ej-fecha"/></div>
          <div class="form-group"><label>Lugar</label><input type="text" id="ej-lugar" placeholder="Sala, comedor, etc."/></div>
          <div class="form-group full"><label>Observaciones generales</label><textarea id="ej-obs" placeholder="Notas sobre la sesiÃ³n..."></textarea></div>
        </div>
        <div id="ej-asistentes-section" style="display:none; margin-top:16px;">
          <div style="font-size:13px; font-weight:600; color:var(--text-mid); margin-bottom:10px; text-transform:uppercase; letter-spacing:0.4px;">Registro de asistencia</div>
          <div id="ej-asistentes-list"></div>
        </div>
        <div class="form-actions" style="margin-top:16px;">
          <button class="btn btn-outline" onclick="switchTallerTab(document.querySelector('.tab'),'taller-biblioteca')">Cancelar</button>
          <button class="btn btn-primary" onclick="ejecutarTaller()">âœ… Registrar ejecuciÃ³n</button>
        </div>
      </div>
    </div>
  </div>
`;
pageContent.appendChild(talleresPage);

// â”€â”€â”€ INJECT TALLER DETAIL PAGE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const tallerDetailPage = document.createElement('div');
tallerDetailPage.className = 'page';
tallerDetailPage.id = 'page-taller-detalle';
tallerDetailPage.innerHTML = `
  <button class="btn btn-outline btn-sm" onclick="showPage('talleres')" style="margin-bottom:16px;">â† Volver a talleres</button>
  
  <div class="ficha-header" id="taller-detail-header">
    <div style="width:56px;height:56px;background:rgba(42,127,255,0.12);border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:26px;flex-shrink:0;">ğŸ“</div>
    <div style="flex:1;">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:6px;">
        <div class="ficha-name" id="td-titulo">Taller</div>
        <span class="badge badge-blue" id="td-area">Ãrea</span>
      </div>
      <div class="ficha-meta">
        <div class="ficha-meta-item">â±ï¸ <span id="td-duracion">60 min</span></div>
        <div class="ficha-meta-item">ğŸ‘¥ <span id="td-poblacion">PoblaciÃ³n</span></div>
        <div class="ficha-meta-item">â–¶ï¸ <span id="td-ejecuciones">0 ejecuciones</span></div>
      </div>
    </div>
    <div class="ficha-actions">
      <button class="btn btn-outline btn-sm" onclick="openModal('modal-subir-archivo')">ğŸ“ Adjuntar</button>
      <button class="btn btn-primary btn-sm" onclick="switchTallerTab(document.querySelectorAll('#page-talleres .tab')[2],'taller-nuevo-ej'); showPage('talleres')">â–¶ï¸ Ejecutar</button>
    </div>
  </div>

  <div class="subtabs">
    <div class="subtab active" onclick="switchSubTab(this,'std-resumen')">Resumen</div>
    <div class="subtab" onclick="switchSubTab(this,'std-diapositivas')">ğŸ–¼ï¸ Diapositivas</div>
    <div class="subtab" onclick="switchSubTab(this,'std-actividades')">ğŸ¯ Actividades</div>
    <div class="subtab" onclick="switchSubTab(this,'std-material')">ğŸ“‹ Material</div>
    <div class="subtab" onclick="switchSubTab(this,'std-archivos')">ğŸ“ Archivos</div>
    <div class="subtab" onclick="switchSubTab(this,'std-asistencia')">âœ… Asistencia</div>
  </div>

  <div id="std-resumen" class="tab-content active">
    <div class="card">
      <div class="card-header"><div class="card-title">Objetivo general</div></div>
      <div class="card-body">
        <p id="td-objetivo" style="font-size:14px;line-height:1.7;color:var(--text-mid);"></p>
        <div style="margin-top:16px;">
          <div style="font-size:12px;font-weight:600;color:var(--text-soft);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px;">Objetivos especÃ­ficos</div>
          <ul id="td-obj-especificos" style="padding-left:16px;font-size:13px;color:var(--text-mid);line-height:1.8;"></ul>
        </div>
        <div style="margin-top:16px;">
          <div style="font-size:12px;font-weight:600;color:var(--text-soft);text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px;">Materiales necesarios</div>
          <div id="td-materiales" style="display:flex;gap:8px;flex-wrap:wrap;"></div>
        </div>
      </div>
    </div>
  </div>

  <div id="std-diapositivas" class="tab-content">
    <div class="section-header" style="margin-bottom:14px;">
      <div class="section-title" style="font-size:16px;">Diapositivas</div>
      <button class="btn btn-primary btn-sm" onclick="openModal('modal-nueva-diapositiva')">+ Agregar</button>
    </div>
    <div id="td-diapositivas"></div>
  </div>

  <div id="std-actividades" class="tab-content">
    <div class="section-header" style="margin-bottom:14px;">
      <div class="section-title" style="font-size:16px;">Actividades</div>
      <button class="btn btn-primary btn-sm" onclick="openModal('modal-nueva-actividad')">+ Agregar</button>
    </div>
    <div id="td-actividades"></div>
  </div>

  <div id="std-material" class="tab-content">
    <div class="section-header" style="margin-bottom:14px;">
      <div class="section-title" style="font-size:16px;">Material imprimible</div>
      <button class="btn btn-primary btn-sm" onclick="openModal('modal-nuevo-material')">+ Agregar</button>
    </div>
    <div id="td-material"></div>
  </div>

  <div id="std-archivos" class="tab-content">
    <div class="section-header" style="margin-bottom:14px;">
      <div class="section-title" style="font-size:16px;">Archivos adjuntos</div>
      <button class="btn btn-primary btn-sm" onclick="openModal('modal-subir-archivo')">+ Subir</button>
    </div>
    <div id="td-archivos"></div>
  </div>

  <div id="std-asistencia" class="tab-content">
    <div class="section-header" style="margin-bottom:14px;">
      <div class="section-title" style="font-size:16px;">Historial de asistencia</div>
    </div>
    <div id="td-asistencia"></div>
  </div>
`;
pageContent.appendChild(tallerDetailPage);

// â”€â”€â”€ INJECT MODALES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const modalHTML = `
<!-- Modal: Nuevo Taller -->
<div class="modal-overlay" id="modal-nuevo-taller">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">Nuevo Taller</div>
      <button class="modal-close" onclick="closeModal('modal-nuevo-taller')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group full"><label>TÃ­tulo *</label><input type="text" id="nt-titulo" placeholder="Ej: Taller de ComunicaciÃ³n Familiar"/></div>
        <div class="form-group">
          <label>Ãrea *</label>
          <select id="nt-area">
            <option value="parentalidad">Parentalidad</option>
            <option value="autocuidado">Autocuidado</option>
            <option value="empleabilidad">Empleabilidad</option>
            <option value="educacion">EducaciÃ³n</option>
            <option value="salud">Salud</option>
            <option value="otro">Otro</option>
          </select>
        </div>
        <div class="form-group"><label>DuraciÃ³n (minutos) *</label><input type="number" id="nt-duracion" value="90"/></div>
        <div class="form-group full"><label>PoblaciÃ³n objetivo</label><input type="text" id="nt-poblacion" placeholder="Ej: NNA de 12-17 aÃ±os"/></div>
        <div class="form-group full"><label>Objetivo general *</label><textarea id="nt-objetivo" placeholder="Objetivo principal del taller..."></textarea></div>
        <div class="form-group full"><label>DescripciÃ³n</label><textarea id="nt-desc" placeholder="DescripciÃ³n general del taller..."></textarea></div>
        <div class="form-group full"><label>Materiales (separados por coma)</label><input type="text" id="nt-materiales" placeholder="Ej: Papel, lÃ¡pices, tijeras"/></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modal-nuevo-taller')">Cancelar</button>
      <button class="btn btn-primary" onclick="saveTaller()">Crear taller</button>
    </div>
  </div>
</div>

<!-- Modal: Nueva Diapositiva -->
<div class="modal-overlay" id="modal-nueva-diapositiva">
  <div class="modal" style="max-width:500px;">
    <div class="modal-header">
      <div class="modal-title">Nueva Diapositiva</div>
      <button class="modal-close" onclick="closeModal('modal-nueva-diapositiva')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group full"><label>TÃ­tulo</label><input type="text" id="nd-titulo" placeholder="TÃ­tulo de la diapositiva"/></div>
        <div class="form-group full"><label>Contenido</label><textarea id="nd-contenido" style="min-height:120px;" placeholder="Puntos clave, texto, etc."></textarea></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modal-nueva-diapositiva')">Cancelar</button>
      <button class="btn btn-primary" onclick="saveDiapositiva()">Agregar</button>
    </div>
  </div>
</div>

<!-- Modal: Nueva Actividad -->
<div class="modal-overlay" id="modal-nueva-actividad">
  <div class="modal" style="max-width:500px;">
    <div class="modal-header">
      <div class="modal-title">Nueva Actividad</div>
      <button class="modal-close" onclick="closeModal('modal-nueva-actividad')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group full"><label>Nombre</label><input type="text" id="na-nombre" placeholder="Nombre de la actividad"/></div>
        <div class="form-group"><label>Tiempo estimado (min)</label><input type="number" id="na-tiempo" value="15"/></div>
        <div class="form-group"><label>Tipo</label>
          <select id="na-tipo"><option>DinÃ¡mica grupal</option><option>ReflexiÃ³n individual</option><option>Juego</option><option>ExposiciÃ³n</option><option>Debate</option></select>
        </div>
        <div class="form-group full"><label>DescripciÃ³n</label><textarea id="na-desc" placeholder="DescripciÃ³n de la actividad..."></textarea></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modal-nueva-actividad')">Cancelar</button>
      <button class="btn btn-primary" onclick="saveActividad()">Agregar</button>
    </div>
  </div>
</div>

<!-- Modal: Subir Archivo -->
<div class="modal-overlay" id="modal-subir-archivo">
  <div class="modal" style="max-width:440px;">
    <div class="modal-header">
      <div class="modal-title">Subir archivo al taller</div>
      <button class="modal-close" onclick="closeModal('modal-subir-archivo')">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="form-grid">
        <div class="form-group full"><label>Nombre descriptivo</label><input type="text" id="arch-nombre" placeholder="Ej: PresentaciÃ³n Canva SesiÃ³n 1"/></div>
        <div class="form-group full">
          <label>Archivo (PDF, PPTX, DOCX)</label>
          <input type="file" id="arch-file" accept=".pdf,.pptx,.docx,.doc"/>
        </div>
      </div>
      <div style="margin-top:12px;padding:12px;background:var(--mist);border-radius:var(--radius-sm);font-size:12px;color:var(--text-soft);">
        âœ… Formatos aceptados: PDF, PowerPoint (PPTX), Word (DOCX)<br/>
        âœ… Incluye presentaciones exportadas desde Canva
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeModal('modal-subir-archivo')">Cancelar</button>
      <button class="btn btn-primary" onclick="subirArchivo()">Subir archivo</button>
    </div>
  </div>
</div>
`;
document.body.insertAdjacentHTML('beforeend', modalHTML);

// Close modals on overlay click
document.querySelectorAll('.modal-overlay').forEach(overlay => {
  overlay.addEventListener('click', e => {
    if (e.target === overlay) overlay.classList.remove('open');
  });
});

// â”€â”€â”€ TALLERES DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let talleresData = [
  {
    id: "t1",
    titulo: "ComunicaciÃ³n Familiar Efectiva",
    area: "parentalidad",
    objetivo_general: "Desarrollar habilidades de comunicaciÃ³n asertiva entre NNA y sus familias para fortalecer los vÃ­nculos afectivos y mejorar la dinÃ¡mica familiar.",
    objetivos_especificos: [
      "Identificar patrones de comunicaciÃ³n en la familia",
      "Practicar tÃ©cnicas de escucha activa",
      "Desarrollar expresiÃ³n emocional saludable"
    ],
    duracion_minutos: 90,
    poblacion_objetivo: "NNA de 10-17 aÃ±os con familias",
    descripcion: "Taller interactivo que aborda la comunicaciÃ³n dentro del nÃºcleo familiar.",
    materiales: ["Papel kraft", "Plumones", "Tarjetas de emociÃ³n", "Pelota antiestrÃ©s"],
    diapositivas: [
      { titulo: "Â¿CÃ³mo nos comunicamos en familia?", contenido: "â€¢ Los patrones de comunicaciÃ³n\nâ€¢ ComunicaciÃ³n verbal vs no verbal\nâ€¢ Barreras mÃ¡s comunes", orden: 1 },
      { titulo: "Escucha activa", contenido: "â€¢ Mirar a los ojos\nâ€¢ No interrumpir\nâ€¢ Parafrasear lo que escuchamos\nâ€¢ Validar emociones", orden: 2 },
      { titulo: "PrÃ¡ctica", contenido: "DinÃ¡mica: 'El telÃ©fono emocional'\nCada participante comparte una emociÃ³n que quiere que la familia entienda.", orden: 3 }
    ],
    actividades: [
      { nombre: "Mapa familiar", descripcion: "Cada NNA dibuja su red familiar e identifica con quiÃ©n se comunica mejor y por quÃ©.", tiempo_estimado: 20, tipo: "ReflexiÃ³n individual" },
      { nombre: "Role play comunicaciÃ³n", descripcion: "Por parejas practican cÃ³mo pedir algo a un familiar usando comunicaciÃ³n asertiva.", tiempo_estimado: 25, tipo: "DinÃ¡mica grupal" }
    ],
    material_imprimible: [
      { tipo: "ficha", titulo: "Ficha de autoconocimiento comunicacional", contenido: "Â¿CÃ³mo me comunico cuando estoy enojado/a?\nÂ¿CÃ³mo me gustarÃ­a que me hablaran?\nÂ¿QuÃ© necesito de mi familia?" }
    ],
    archivos: [
      { id: "a1", nombre_original: "Presentacion_Comunicacion.pdf", tipo: "pdf", subido_por: "Ana MartÃ­nez", fecha_subida: "2025-01-15" }
    ],
    total_ejecuciones: 3,
    creado_por: "Ana MartÃ­nez"
  },
  {
    id: "t2",
    titulo: "Autocuidado y RegulaciÃ³n Emocional",
    area: "autocuidado",
    objetivo_general: "Fortalecer las habilidades de autocuidado y regulaciÃ³n emocional en NNA para promover el bienestar mental.",
    objetivos_especificos: [
      "Reconocer seÃ±ales de malestar emocional",
      "Aprender tÃ©cnicas de regulaciÃ³n emocional",
      "Construir un plan personal de autocuidado"
    ],
    duracion_minutos: 75,
    poblacion_objetivo: "NNA de 12-17 aÃ±os",
    descripcion: "Taller centrado en herramientas prÃ¡cticas de autocuidado y manejo emocional.",
    materiales: ["Cartulinas", "Revistas", "Pegamento", "Tijeras"],
    diapositivas: [
      { titulo: "Â¿QuÃ© es el autocuidado?", contenido: "â€¢ Cuerpo, mente y emociones\nâ€¢ No es egoÃ­smo, es necesidad\nâ€¢ SeÃ±ales de alarma", orden: 1 },
      { titulo: "TÃ©cnicas de regulaciÃ³n", contenido: "â€¢ RespiraciÃ³n 4-7-8\nâ€¢ Anclaje sensorial (5-4-3-2-1)\nâ€¢ Movimiento corporal", orden: 2 }
    ],
    actividades: [
      { nombre: "Collage de bienestar", descripcion: "Crear un collage con imÃ¡genes y palabras que representan el bienestar personal.", tiempo_estimado: 30, tipo: "DinÃ¡mica grupal" }
    ],
    material_imprimible: [],
    archivos: [],
    total_ejecuciones: 5,
    creado_por: "Carlos Vera"
  },
  {
    id: "t3",
    titulo: "Habilidades para la Vida",
    area: "empleabilidad",
    objetivo_general: "Desarrollar competencias bÃ¡sicas para la vida independiente y la inserciÃ³n laboral futura.",
    objetivos_especificos: [
      "Identificar fortalezas y habilidades personales",
      "Conocer derechos laborales bÃ¡sicos",
      "Elaborar un CV bÃ¡sico"
    ],
    duracion_minutos: 120,
    poblacion_objetivo: "NNA de 15-17 aÃ±os",
    descripcion: "Taller orientado al desarrollo de competencias para la vida adulta independiente.",
    materiales: ["Computador", "Impresora", "Formulario CV"],
    diapositivas: [],
    actividades: [],
    material_imprimible: [],
    archivos: [],
    total_ejecuciones: 2,
    creado_por: "Ana MartÃ­nez"
  }
];

let ejecucionesData = [
  { id:"e1", taller_titulo:"ComunicaciÃ³n Familiar", taller_area:"parentalidad", fecha:"2025-02-10", asistentes:[{nna_nombre:"MatÃ­as R.",presente:true},{nna_nombre:"Valentina S.",presente:true},{nna_nombre:"Diego F.",presente:false}], profesional_nombre:"Ana MartÃ­nez" },
  { id:"e2", taller_titulo:"Autocuidado", taller_area:"autocuidado", fecha:"2025-02-05", asistentes:[{nna_nombre:"Camila T.",presente:true},{nna_nombre:"Andrea M.",presente:true}], profesional_nombre:"Carlos Vera" }
];

let currentTaller = null;

// â”€â”€â”€ RENDER FUNCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTalleres() {
  const list = document.getElementById('talleres-list');
  if (!list) return;
  list.innerHTML = talleresData.map(t => `
    <div class="taller-card ${t.area}" onclick="openTallerDetalle('${t.id}')">
      <div class="taller-header">
        <div class="taller-title">${t.titulo}</div>
        <span class="taller-area-badge area-${t.area}">${areaLabel(t.area)}</span>
      </div>
      <p style="font-size:13px;color:var(--text-mid);margin-bottom:12px;line-height:1.5;">${t.descripcion}</p>
      <div class="taller-meta">
        <span>â±ï¸ ${t.duracion_minutos} min</span>
        <span>ğŸ‘¥ ${t.poblacion_objetivo}</span>
        <span>â–¶ï¸ ${t.total_ejecuciones} ejecuciones</span>
        <span>ğŸ“ ${t.archivos.length} archivos</span>
        <span>ğŸ–¼ï¸ ${t.diapositivas.length} diapositivas</span>
      </div>
    </div>
  `).join('');

  // Render ejecuciones table
  const tbody = document.getElementById('ejecuciones-table');
  if (tbody) {
    tbody.innerHTML = ejecucionesData.map(e => `
      <tr>
        <td class="td-name">${e.taller_titulo}</td>
        <td><span class="taller-area-badge area-${e.taller_area}">${areaLabel(e.taller_area)}</span></td>
        <td>${e.fecha}</td>
        <td>${e.asistentes.filter(a=>a.presente).length}/${e.asistentes.length} presentes</td>
        <td>${e.profesional_nombre}</td>
        <td><button class="btn btn-outline btn-sm">ğŸ‘ Ver</button></td>
      </tr>
    `).join('');
  }

  // Populate ejecutar select
  const sel = document.getElementById('ej-taller-select');
  if (sel) {
    sel.innerHTML = '<option value="">-- Elige un taller --</option>' +
      talleresData.map(t => `<option value="${t.id}">${t.titulo}</option>`).join('');
  }
}

function areaLabel(area) {
  return { parentalidad:'Parentalidad', autocuidado:'Autocuidado', empleabilidad:'Empleabilidad', educacion:'EducaciÃ³n', salud:'Salud', otro:'Otro' }[area] || area;
}

function openTallerDetalle(id) {
  const t = talleresData.find(x => x.id === id);
  if (!t) return;
  currentTaller = t;

  document.getElementById('td-titulo').textContent = t.titulo;
  document.getElementById('td-area').textContent = areaLabel(t.area);
  document.getElementById('td-duracion').textContent = t.duracion_minutos + ' min';
  document.getElementById('td-poblacion').textContent = t.poblacion_objetivo;
  document.getElementById('td-ejecuciones').textContent = t.total_ejecuciones + ' ejecuciones';
  document.getElementById('td-objetivo').textContent = t.objetivo_general;

  // Objetivos especÃ­ficos
  const ul = document.getElementById('td-obj-especificos');
  ul.innerHTML = (t.objetivos_especificos || []).map(o => `<li>${o}</li>`).join('');

  // Materiales
  const mats = document.getElementById('td-materiales');
  mats.innerHTML = (t.materiales || []).map(m => `<span class="badge badge-blue">${m}</span>`).join('');

  // Diapositivas
  const diaps = document.getElementById('td-diapositivas');
  diaps.innerHTML = t.diapositivas.length ? t.diapositivas.map((d,i) => `
    <div class="diapositiva-card">
      <div class="diapositiva-num">Diapositiva ${i+1}</div>
      <div class="diapositiva-titulo">${d.titulo}</div>
      <div class="diapositiva-content">${d.contenido.replace(/\n/g,'<br/>')}</div>
    </div>
  `).join('') : '<div class="empty-state"><div class="empty-icon">ğŸ–¼ï¸</div><div class="empty-text">Sin diapositivas aÃºn</div><button class="btn btn-primary" onclick="openModal(\'modal-nueva-diapositiva\')">+ Agregar</button></div>';

  // Actividades
  const acts = document.getElementById('td-actividades');
  acts.innerHTML = t.actividades.length ? t.actividades.map(a => `
    <div class="intervencion-card bajo" style="margin-bottom:12px;">
      <div class="intervencion-header">
        <div class="intervencion-tipo">ğŸ¯ ${a.nombre}</div>
        <span class="badge badge-blue">${a.tipo}</span>
        <div class="intervencion-fecha">â±ï¸ ${a.tiempo_estimado} min</div>
      </div>
      <div class="intervencion-desc">${a.descripcion}</div>
    </div>
  `).join('') : '<div class="empty-state"><div class="empty-icon">ğŸ¯</div><div class="empty-text">Sin actividades aÃºn</div></div>';

  // Material imprimible
  const mat = document.getElementById('td-material');
  mat.innerHTML = t.material_imprimible.length ? t.material_imprimible.map(m => `
    <div class="registro-card">
      <div class="registro-date">ğŸ“‹ ${m.titulo} Â· <span class="badge badge-blue">${m.tipo}</span></div>
      <div style="font-size:13px;color:var(--text-mid);margin-top:8px;line-height:1.7;">${m.contenido.replace(/\n/g,'<br/>')}</div>
      <div style="margin-top:10px;"><button class="btn btn-outline btn-sm" onclick="showToast('Preparando impresiÃ³n...','success')">ğŸ–¨ï¸ Imprimir</button></div>
    </div>
  `).join('') : '<div class="empty-state"><div class="empty-icon">ğŸ“‹</div><div class="empty-text">Sin material imprimible</div></div>';

  // Archivos
  const archs = document.getElementById('td-archivos');
  archs.innerHTML = t.archivos.length ? t.archivos.map(a => `
    <div class="archivo-item">
      <div class="archivo-icon">${a.tipo==='pdf'?'ğŸ“„':a.tipo==='pptx'?'ğŸ“Š':'ğŸ“'}</div>
      <div class="archivo-info">
        <div class="archivo-name">${a.nombre_original}</div>
        <div class="archivo-meta">Subido por ${a.subido_por} Â· ${a.fecha_subida}</div>
      </div>
      <button class="btn btn-outline btn-sm" onclick="showToast('Descargando...','success')">â¬‡ï¸</button>
      <button class="btn btn-danger btn-sm" onclick="showToast('Archivo eliminado','success')">ğŸ—‘ï¸</button>
    </div>
  `).join('') : '<div class="empty-state"><div class="empty-icon">ğŸ“</div><div class="empty-text">Sin archivos adjuntos. Puedes subir PDF, PPTX o DOCX.</div><button class="btn btn-primary" onclick="openModal(\'modal-subir-archivo\')">+ Subir archivo</button></div>';

  // Asistencia histÃ³rica
  const asist = document.getElementById('td-asistencia');
  const ejecs = ejecucionesData.filter(e => e.taller_titulo === t.titulo);
  asist.innerHTML = ejecs.length ? ejecs.map(e => `
    <div class="registro-card">
      <div class="registro-date">ğŸ“… ${e.fecha} â€” ${e.profesional_nombre}</div>
      <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap;">
        ${e.asistentes.map(a => `<span class="badge ${a.presente?'badge-active':'badge-egreso'}">${a.presente?'âœ“':'âœ—'} ${a.nna_nombre}</span>`).join('')}
      </div>
    </div>
  `).join('') : '<div class="empty-state"><div class="empty-icon">âœ…</div><div class="empty-text">Sin ejecuciones registradas aÃºn</div></div>';

  showPage('taller-detalle');
}

function switchTallerTab(el, targetId) {
  const page = document.getElementById('page-talleres');
  page.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  page.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
  const target = document.getElementById(targetId);
  if (target) target.classList.add('active');
  if (targetId === 'taller-nuevo-ej') loadAsistentesEjecucion();
}

function switchSubTab(el, targetId) {
  el.parentElement.querySelectorAll('.subtab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  document.querySelectorAll('#page-taller-detalle .tab-content').forEach(tc => tc.classList.remove('active'));
  const target = document.getElementById(targetId);
  if (target) target.classList.add('active');
}

function loadTallerInfo(id) {
  if (!id) { document.getElementById('ej-asistentes-section').style.display='none'; return; }
  document.getElementById('ej-asistentes-section').style.display='block';
  loadAsistentesEjecucion();
}

function loadAsistentesEjecucion() {
  const list = document.getElementById('ej-asistentes-list');
  if (!list) return;
  list.innerHTML = nnaData.filter(n=>n.estado==='activo').map(n => `
    <div class="asistente-row">
      <input type="checkbox" class="asistente-check" id="asist-${n.id}" checked/>
      <div class="asistente-avatar" style="width:32px;height:32px;background:var(--fog);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:var(--slate);">${n.iniciales}</div>
      <div class="asistente-name">${n.nombre}</div>
      <div class="asistente-obs"><input type="text" placeholder="ObservaciÃ³n (opcional)..." style="font-size:12px;padding:6px 10px;"/></div>
    </div>
  `).join('');
}

// â”€â”€â”€ SAVE FUNCTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveTaller() {
  const titulo = document.getElementById('nt-titulo').value;
  if (!titulo) { showToast('Ingresa el tÃ­tulo del taller', 'error'); return; }
  const nuevo = {
    id: 't' + Date.now(),
    titulo,
    area: document.getElementById('nt-area').value,
    objetivo_general: document.getElementById('nt-objetivo').value,
    objetivos_especificos: [],
    duracion_minutos: parseInt(document.getElementById('nt-duracion').value) || 90,
    poblacion_objetivo: document.getElementById('nt-poblacion').value,
    descripcion: document.getElementById('nt-desc').value,
    materiales: document.getElementById('nt-materiales').value.split(',').map(m=>m.trim()).filter(Boolean),
    diapositivas: [], actividades: [], material_imprimible: [], archivos: [],
    total_ejecuciones: 0,
    creado_por: currentUser?.nombre || 'Sistema'
  };
  talleresData.unshift(nuevo);
  renderTalleres();
  closeModal('modal-nuevo-taller');
  showToast('Taller creado exitosamente âœ…', 'success');
}

function saveDiapositiva() {
  if (!currentTaller) return;
  const d = { titulo: document.getElementById('nd-titulo').value, contenido: document.getElementById('nd-contenido').value, orden: currentTaller.diapositivas.length + 1 };
  currentTaller.diapositivas.push(d);
  openTallerDetalle(currentTaller.id);
  closeModal('modal-nueva-diapositiva');
  showToast('Diapositiva agregada âœ…', 'success');
}

function saveActividad() {
  if (!currentTaller) return;
  const a = { nombre: document.getElementById('na-nombre').value, descripcion: document.getElementById('na-desc').value, tiempo_estimado: parseInt(document.getElementById('na-tiempo').value)||15, tipo: document.getElementById('na-tipo').value };
  currentTaller.actividades.push(a);
  openTallerDetalle(currentTaller.id);
  closeModal('modal-nueva-actividad');
  showToast('Actividad agregada âœ…', 'success');
}

function subirArchivo() {
  const file = document.getElementById('arch-file').files[0];
  const nombre = document.getElementById('arch-nombre').value;
  if (!file) { showToast('Selecciona un archivo', 'error'); return; }
  const ext = file.name.split('.').pop();
  const archivo = { id: 'a'+Date.now(), nombre_original: nombre || file.name, tipo: ext, subido_por: currentUser?.nombre||'Usuario', fecha_subida: new Date().toISOString().split('T')[0] };
  if (currentTaller) {
    currentTaller.archivos.push(archivo);
    openTallerDetalle(currentTaller.id);
  }
  closeModal('modal-subir-archivo');
  showToast('Archivo subido exitosamente âœ…', 'success');
}

function ejecutarTaller() {
  const tallerId = document.getElementById('ej-taller-select').value;
  const fecha = document.getElementById('ej-fecha').value;
  if (!tallerId || !fecha) { showToast('Selecciona taller y fecha', 'error'); return; }
  const taller = talleresData.find(t=>t.id===tallerId);
  const rows = document.querySelectorAll('#ej-asistentes-list .asistente-row');
  const asistentes = Array.from(rows).map((row, i) => ({
    nna_id: nnaData.filter(n=>n.estado==='activo')[i]?.id,
    nna_nombre: nnaData.filter(n=>n.estado==='activo')[i]?.nombre,
    presente: row.querySelector('.asistente-check').checked,
    observacion: row.querySelector('input[type=text]').value
  }));
  const presentes = asistentes.filter(a=>a.presente).length;
  const ejecucion = { id:'e'+Date.now(), taller_titulo: taller.titulo, taller_area: taller.area, fecha, asistentes, profesional_nombre: currentUser?.nombre||'Profesional' };
  ejecucionesData.unshift(ejecucion);
  taller.total_ejecuciones++;
  // Simular creaciÃ³n automÃ¡tica de intervenciones
  showToast(`âœ… Taller ejecutado. ${presentes} intervenciones generadas automÃ¡ticamente.`, 'success');
  renderTalleres();
}

// Override renderAll to include talleres
const _origRenderAll = renderAll;
window.renderAll = function() { _origRenderAll(); renderTalleres(); };

// Override showPage to handle taller-detalle
const _origShowPage = showPage;
window.showPage = function(page) {
  _origShowPage(page);
  if (page === 'talleres') renderTalleres();
  // Update title
  if (page === 'taller-detalle') document.getElementById('page-title').textContent = currentTaller?.titulo || 'Detalle Taller';
};

</script>
